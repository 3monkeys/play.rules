joLog=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);console.log(a.join(" "))};Function.prototype.extend=function(a,b){function c(){this.constructor=d}var d=this;c.prototype=a.prototype;d.prototype=new c;d.__super__=a.prototype;if(b)for(var e in b)this.prototype[e]=b[e]};if(typeof Function.prototype.bind==="undefined")Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};typeof HTMLElement==="undefined"&&(HTMLElement=Object);
typeof console==="undefined"&&(console={});if(typeof console.log!=="function")console.log=function(){};
jo={platform:"webkit",version:"0.4.2",useragent:"ipad,iphone,playbook,webos,hpwos,bada,android,opera,chrome,safari,mozilla,gecko,explorer".split(","),debug:!1,setDebug:function(a){this.debug=a},flag:{stopback:!1},load:function(){joDOM.enable();this.loadEvent=new joSubject(this);this.unloadEvent=new joSubject(this);document.body.onMouseDown=function(a){a.preventDefault()};document.body.onDragStart=function(a){a.preventDefault()};if(typeof navigator=="object"&&navigator.userAgent)for(var a=navigator.userAgent.toLowerCase(),
b=0;b<this.useragent.length;b++)if(a.indexOf(this.useragent[b])>=0){this.platform=this.useragent[b];break}if(joEvent)a=document.createElement("div"),b="ontouchstart"in a,b||(a.setAttribute("ontouchstart","return;"),b=typeof a.ontouchstart==="function"),joEvent.touchy=b,a=null;joGesture&&joGesture.load();a=joScroller.prototype;if(typeof document.body.style.webkitTransition==="undefined")typeof document.body.style.MozTransition!=="undefined"?(a.transitionEnd="transitionend",a.setPosition=function(a,
b,e){e.style.MozTransform="translate("+a+"px,"+b+"px)"}):typeof document.body.style.msTransform!=="undefined"?(a.transitionEnd="transitionend",a.setPosition=function(a,b,e){e.style.msTransform="translate("+a+"px,"+b+"px)"}):typeof document.body.style.OTransition!=="undefined"?(a.transitionEnd="otransitionend",a.setPosition=function(a,b,e){e.style.OTransform="translate("+a+"px,"+b+"px)"}):(a.velocity=0,a.bump=0,a.transitionEnd="transitionend",a.setPosition=function(a,b,e){if(this.vertical)e.style.top=
b+"px";if(this.horizontal)e.style.left=a+"px"});joLog("Jo",this.version,"loaded for",this.platform,"environment");this.loadEvent.fire()},tagMap:{},tagMapLoaded:!1,initTagMap:function(){if(!this.tagMapLoaded){var a=this.tagMap;a.JOVIEW=joView;a.BODY=joScreen;for(var b in window){var c=window[b];if(typeof c==="function"&&c.prototype&&typeof c.prototype.tagName!=="undefined"&&c.prototype instanceof joView){var d=c.prototype.tagName.toUpperCase();c.prototype.type?(a[d]||(a[d]={}),a[d][c.prototype.type]=
c):a[d]=c}}}},getPlatform:function(){return this.platform},matchPlatform:function(a){return a.indexOf(this.platform)>=0},getVersion:function(){return this.version},getLanguage:function(){return this.language}};
joDOM={enabled:!1,get:function(a){if(typeof a==="string")return document.getElementById(a);else if(typeof a==="object")return a instanceof joView?a.container:a},remove:function(a){a.parentNode&&a.parentNode.removeChild(a)},enable:function(){this.enabled=!0},getParentWithin:function(a,b){for(;a.parentNode!==window&&a.parentNode!==b;)a=a.parentNode;return a},addCSSClass:function(a,b){a=joDOM.get(a);if(typeof a.className!=="undefined"){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==
b)return;c.push(b);a.className=c.join(" ")}else a.className=b},removeCSSClass:function(a,b,c){a=joDOM.get(a);if(typeof a.className!=="undefined"){for(var d=a.className.split(/\s+/),e=0,f=d.length;e<f;e++)if(d[e]==b){f==1?a.className="":(d.splice(e,1),a.className=d.join(" "));return}if(c)d.push(b),a.className=d.join(" ")}else a.className=b},toggleCSSClass:function(a,b){this.removeCSSClass(a,b,!0)},create:function(a,b){if(!this.enabled)return null;var c;typeof a==="object"&&typeof a.tagName==="string"?
(c=document.createElement(a.tagName),a.className&&this.setStyle(c,a.className)):(c=document.createElement(a),b&&this.setStyle(c,b));return c},setStyle:function(a,b){a=joDOM.get(a);if(typeof b==="string")a.className=b;else if(typeof b==="object")for(var c in b)switch(c){case "id":case "className":a[c]=b[c];break;default:a.style[c]=b[c]}else if(typeof b!=="undefined")throw"joDOM.setStyle(): unrecognized type for style argument; must be object or string.";},applyCSS:function(a,b){b&&document.body.removeChild(b);
var c=joDOM.create("jostyle");c.innerHTML="<style>"+a+"</style>";document.body.appendChild(c);return c},removeCSS:function(a){document.body.removeChild(a)},loadCSS:function(a,b){var c=b?b:joDOM.create("link");c.rel="stylesheet";c.type="text/css";c.href=a+(jo.debug?"?"+joTime.timestamp():"");b||document.body.appendChild(c);return c},pageOffsetLeft:function(a){for(var b=0;typeof a!=="undefined"&&a&&a.parentNode!==window;)a.offsetLeft&&(b+=a.offsetLeft),a=a.parentNode;return b},pageOffsetTop:function(a){for(var b=
0;typeof a!=="undefined"&&a&&a.parentNode!==window;)a.offsetTop&&(b+=a.offsetTop),a=a.parentNode;return b},getBounds:function(a){var b=joDOM.pageOffsetTop(a),c=joDOM.pageOffsetLeft(a),d=b+a.offsetHeight,a=c+a.offsetWidth;return{top:b,left:c,bottom:d,right:a,center:{x:c+(a-c)/2,y:b+(d-b)/2}}}};joCSSRule=function(a){this.setData(a)};
joCSSRule.prototype={container:null,setData:function(a){this.data=a||"";this.enable()},clear:function(){this.setData()},disable:function(){joDOM.removeCSS(this.container)},enable:function(){this.container=joDOM.applyCSS(this.data,this.container)}};
joEvent={eventMap:{mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend",mouseout:"touchcancel"},touchy:!1,getTarget:function(a){if(!a)a=window.event;return a.target?a.target:a.srcElement},capture:function(a,b,c,d,e){return this.on(a,b,c,d,e,!0)},on:function(a,b,c,d,e,f){function g(a){if(a.touches&&a.touches.length==1){var b=a.touches[0];a.pageX=b.pageX;a.pageY=b.pageY;a.screenX=b.screenX;a.screenY=b.screenY;a.clientX=b.clientX;a.clientY=b.clientY}d?c.call(d,a,e):c(a,e)}if(!c||!a)return!1;
this.touchy&&this.eventMap[b]&&(b=this.eventMap[b]);a=joDOM.get(a);g.capture=f||!1;window.addEventListener?a.addEventListener(b,g,f||!1):a.attachEvent("on"+b,g);return g},remove:function(a,b,c,d){this.touchy&&this.eventMap[b]&&(b=this.eventMap[b]);typeof a.removeEventListener!=="undefined"&&a.removeEventListener(b,c,d||!1)},stop:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault()},block:function(a){if(window.event)a=window.event;if(typeof a.target==
"undefined")a.target=a.srcElement;switch(a.target.nodeName.toLowerCase()){case "input":case "textarea":return!0;default:return!1}}};joSubject=function(a){this.subscriptions=[];this.subject=a};
joSubject.prototype={last:-1,subscribe:function(a,b,c){if(!a)return!1;a={call:a};if(b)a.observer=b;if(c)a.data=c;this.subscriptions.push(a);return this.subject},unsubscribe:function(a,b){if(!a)return!1;for(var c=0,d=this.subscriptions.length;c<d;c++){var e=this.subscriptions[c];if(e.call===a&&(typeof e.observer==="undefined"||e.observer===b)){this.subscriptions.splice(c,1);break}}return this.subject},resume:function(a){this.last!=-1&&this.fire(a,!0);return this.subject},fire:function(a,b){typeof a===
"undefined"&&(a="");var c=b?this.last||0:0;this.last=-1;for(var d=this.subscriptions.length;c<d;c++){var e=this.subscriptions[c],f=typeof e.data!=="undefined"?e.data:null;e.observer?e.call.call(e.observer,a,this.subject,f):e.call(a,this.subject,f);if(e.capture){this.last=c+1;break}}return this.subject},capture:function(a,b,c){if(!a)return!1;a={call:a,capture:!0};if(b)a.observer=b;if(c)a.data=c;this.subscriptions.unshift(a);return this.subject},release:function(a,b){return this.unsubscribe(a,b)}};
var SEC=1E3,MIN=60*SEC,HOUR=60*MIN,DAY=24*HOUR;joTime={timestamp:function(){return new Date/1}};function joDefer(a,b,c,d){c||(c=100);b||(b=this);return window.setTimeout(function(){a.call(b,d)},c)}joDefer.cancel=function(a){window.clearTimeout(a)};joYield=joDefer;
joCache={cache:{},set:function(a,b,c){b&&(this.cache[a]={call:b,context:c||this});return this},get:function(a){var b=this.cache[a]||null;if(b){if(!b.view)b.view=b.call.apply(b.context,arguments);return b.view}else return new joView("View not found: "+a)},clear:function(a){if(typeof this.cache[a]==="object")this.cache[a].view=null;return this}};joClipboard={data:"",get:function(){return joPreference.get("joClipboardData")||this.data},set:function(a){this.data=a;joPreference.set("joClipboardData")}};
joDataSource=function(a){this.changeEvent=new joSubject(this);this.errorEvent=new joSubject(this);typeof a!=="undefined"?this.setData(a):this.data=""};
joDataSource.prototype={autoSave:!0,data:null,setQuery:function(a){this.query=a;return this},setAutoSave:function(a){this.autoSave=a;return this},setData:function(a){var b=this.data;this.data=a;a!==b&&this.changeEvent.fire(a);return this},getData:function(){return this.data},getDataCount:function(){return this.getData().length},getPageCount:function(){return this.pageSize?Math.floor(this.getData().length/this.pageSize)+1:1},getPage:function(a){a*=this.pageSize;var b=a+this.pageSize;if(b>this.getData().length)b=
this.getData().length;a<0&&(a=0);return this.data.slice(a,b)},refresh:function(){},setPageSize:function(a){this.pageSize=a;return this},getPageSze:function(){return this.pageSize},load:function(a){this.data=a;this.changeEvent.fire(a);return this},error:function(a){this.errorEvent.fire(a)}};joRecord=function(a){joDataSource.call(this,a||{});this.delegate={}};
joRecord.extend(joDataSource,{link:function(a){return this.getDelegate(a)},getDelegate:function(a){this.delegate[a]||(this.delegate[a]=new joProperty(this,a));return this.delegate[a]},getProperty:function(a){return this.data[a]},setProperty:function(a,b){if(!(typeof this.data[a]!=="undefined"&&this.data[a]===b))return this.data[a]=b,this.changeEvent.fire(a),this.autoSave&&this.save(),this},load:function(){console.log("TODO: extend the load() method");return this},save:function(){console.log("TODO: extend the save() method");
return this}});joProperty=function(a,b){joDataSource.call(this);this.changeEvent=new joSubject(this);a.changeEvent.subscribe(this.onSourceChange,this);this.datasource=a;this.p=b};joProperty.extend(joDataSource,{setData:function(a){this.datasource&&this.datasource.setProperty(this.p,a);return this},getData:function(){return!this.datasource?null:this.datasource.getProperty(this.p)},onSourceChange:function(){this.changeEvent.fire(this.getData())}});
joDatabase=function(a,b){this.openEvent=new joSubject(this);this.closeEvent=new joSubject(this);this.errorEvent=new joSubject(this);this.datafile=a;this.size=b||256E3;this.db=null};
joDatabase.prototype={open:function(){(this.db=openDatabase(this.datafile,"1.0",this.datafile,this.size))?this.openEvent.fire():(joLog("DataBase Error",this.db),this.errorEvent.fire());return this},close:function(){this.db.close();this.closeEvent.fire();return this},now:function(a){var b=new Date;a&&b.setDate(b.valueOf()+a*864E5);return b.format("yyyy-mm-dd")}};
joSQLDataSource=function(a,b,c){this.db=a;this.query=typeof b==="undefined"?"":b;this.args=typeof c==="undefined"?[]:c;this.changeEvent=new joSubject(this);this.errorEvent=new joSubject(this)};
joSQLDataSource.prototype={setDatabase:function(a){this.db=a;return this},setQuery:function(a){this.query=a;return this},setData:function(a){this.data=a;this.changeEvent.fire();return this},clear:function(){this.data=[];this.changeEvent.fire();return this},setParameters:function(a){this.args=a;return this},execute:function(a,b){this.setQuery(a||"");this.setParameters(b);this.query&&this.refresh();return this},refresh:function(){function a(a,b){c.data=[];for(var d=0,e=b.rows.length;d<e;d++){var f=
b.rows.item(d);c.data.push(f)}c.changeEvent.fire(c.data)}function b(){joLog("SQL error",f,"argument count",d.length);c.errorEvent.fire()}if(!this.db)return this.errorEvent.fire(),this;var c=this,d;if(arguments.length){d=[];for(var e=0;e<arguments.length;e++)d.push(arguments[e])}else d=this.args;var f=this.query;this.db.db.transaction(function(c){c.executeSql(f,d,a,b)});return this}};
joFileSource=function(a,b){this.changeEvent=new joSubject(this);this.errorEvent=new joSubject(this);b&&this.setTimeout(b);a&&this.setQuery(a)};joFileSource.extend(joDataSource,{baseurl:"",query:"",load:function(){joFile(this.baseurl+this.query,this.callBack,this);return this},callBack:function(a,b){b?this.errorEvent.fire(b):this.setData(a)}});
joFile=function(a,b,c,d){function e(){b&&(c?b.call(c,null,!0):b(null,!0))}var f=new XMLHttpRequest;if(!f)return e();d||(d=60*SEC);var g=d>0?setTimeout(e,d):null;f.open("GET",a,!0);f.onreadystatechange=function(){g&&(g=clearTimeout(g));if(f.readyState==4){var a=f.responseText;b&&(c?b.call(c,a,0):b(a,0))}};f.onError=e;f.send(null)};
function joScript(a,b,c){function d(d){b&&(c?b.call(c,d,a):b(d,a));document.body.removeChild(e);e=null}var e=joDOM.create("script");if(e)e.onload=function(){d(!1)},e.onerror=function(){d(!0)},e.src=a,document.body.appendChild(e)}joPreference=joRecord;joYQL=function(a){joDataSource.call(this);this.setQuery(a)};
joYQL.extend(joDataSource,{baseurl:"http://query.yahooapis.com/v1/public/yql?",format:"json",query:"",exec:function(){var a=this.baseurl+"q="+encodeURIComponent(this.query)+"&format="+this.format+"&callback="+joDepot(this.load,this);joScript(a,this.callBack,this);return this},load:function(a){var b=a.query&&a.query.results&&a.query.results.item;b?(this.data=b,this.changeEvent.fire(b)):this.errorEvent.fire(a);return this},callBack:function(a){a&&this.errorEvent.fire()}});joDepotCall=[];
joDepot=function(a,b){joDepotCall.push(function(c){b?a.call(b,c):a(c)});return"joDepotCall["+(joDepotCall.length-1)+"]"};joDispatch=function(){this.handlers=[];this.loadEvent=new joSubject(this);this.errorEvent=new joSubject(this)};
joDispatch.prototype={load:function(a){var b=this.getHandler(a);if(b){var c=a.substr(b.url.length);b.context?this.loadEvent.fire(b.call.call(b.context,c,a)):this.loadEvent.fire(b.call(c,a))}else joLog("joDispatch: no handler for URL",a),this.errorEvent.fire(a);return this},addHandler:function(a,b,c){if(typeof a!=="undefined")return this.handlers.push({url:a.toLowerCase(),call:b,context:typeof c!==void 0?c:null}),this.handlers=this.handlers.sort(function(a,b){return a.url<b.url?1:a.url==b.url?0:-1}),
this},getHandler:function(a){for(var b=this.handlers,a=a.toLowerCase(),c=0,d=b.length;c<d;c++)if(a.indexOf(b[c].url,0)===0)return b[c];return null}};joInterface=function(a){jo.initTagMap();return this.get(a)};
joInterface.prototype={get:function(a){function b(a){if(a){var d="";if(a.childNodes&&a.firstChild)for(var e=a.childNodes,d=[],f=0,k=e.length;f<k;f++){var j=b(e[f]);j&&d.push(j)}return c(a,d)}}function c(a,b){var c=a.tagName,e=a;if(jo.tagMap[c]){b instanceof Array&&b.length&&b.length==1&&(b=b[0]);if(b instanceof Text)b=a.nodeData;b||(b=a.value||a.checked||a.innerText||a.innerHTML);joView.setContainer=function(){this.container=a;return this};var f;typeof jo.tagMap[c]==="function"?f=jo.tagMap[c]:(f=
a.type||a.getAttribute("type"),f=jo.tagMap[c][f]);typeof f==="function"?e=new f(b):joLog("joInterface can't process ",c,"'type' attribute?")}a.id&&(d[a.id]=e);return e}a=joDOM.get(a);if(!a)a=document.body;var d={},e=joView.setContainer,f=joView.draw;b(a);joView.setContainer=e;joView.draw=f;return d}};joCollect={get:function(a){return new joInterface(a)}};joView=function(a){this.changeEvent=new joSubject(this);this.container=null;this.setContainer();a?this.setData(a):this.data=null};
joView.prototype={tagName:"joview",getContainer:function(){return this.container},setContainer:function(a){this.container=joDOM.get(a);if(!this.container)this.container=this.createContainer();this.setEvents();return this},createContainer:function(){return joDOM.create(this)},clear:function(){this.data="";if(this.container)this.container.innerHTML="";this.changeEvent.fire();return this},setData:function(a){this.data=a;this.refresh();return this},getData:function(){return this.data},refresh:function(){if(!this.container||
typeof this.data==="undefined")return this;this.container.innerHTML="";this.draw();this.changeEvent.fire(this.data);return this},draw:function(){this.container.innerHTML=this.data},setStyle:function(a){joDOM.setStyle(this.container,a);return this},attach:function(a){if(!this.container)return this;(joDOM.get(a)||document.body).appendChild(this.container);return this},detach:function(a){if(!this.container)return this;a=joDOM.get(a)||document.body;this.container&&this.container.parentNode===a&&a.removeChild(this.container);
return this},setEvents:function(){}};joContainer=function(a){joView.apply(this,arguments);this.title=null};
joContainer.extend(joView,{tagName:"jocontainer",getContent:function(){return this.container.childNodes},setTitle:function(a){this.title=a;return this},setData:function(a){this.data=a;return this.refresh()},activate:function(){},deactivate:function(){},push:function(a){if(typeof a!="string")if(a instanceof Array)for(var b=0;b<a.length;b++)this.push(a[b]);else a instanceof joView&&a.container!==this.container?this.container.appendChild(a.container):a instanceof HTMLElement&&this.container.appendChild(a);
else b=document.createElement("div"),b.innerHTML=a,this.container.appendChild(b);return this},getTitle:function(){return this.title},refresh:function(){if(this.container)this.container.innerHTML="";this.draw();this.changeEvent.fire();return this},draw:function(){this.push(this.data)}});
joControl=function(a,b){this.selectEvent=new joSubject(this);this.enabled=!0;this.value=null;if(typeof b!=="undefined"&&b!==null)b instanceof joDataSource?this.setValueSource(b):this.value=b;typeof a!=="undefined"&&a instanceof joDataSource?(joView.call(this),this.setDataSource(a)):joView.apply(this,arguments)};
joControl.extend(joView,{tagName:"jocontrol",setEvents:function(){joEvent.capture(this.container,"click",this.onMouseDown,this);joEvent.on(this.container,"blur",this.onBlur,this);joEvent.on(this.container,"focus",this.onFocus,this)},onMouseDown:function(a){this.select(a)},select:function(a){a&&joEvent.stop(a);this.enabled&&this.selectEvent.fire(this.data);return this},enable:function(){joDOM.removeCSSClass(this.container,"disabled");this.enabled=this.container.contentEditable=!0;return this},disable:function(){joDOM.addCSSClass(this.container,
"disabled");this.enabled=this.container.contentEditable=!1;return this},setReadOnly:function(a){typeof a==="undefined"||a?this.container.setAttribute("readonly","1"):this.container.removeAttribute("readonly");return this},onFocus:function(a){joEvent.stop(a);this.enabled&&joFocus.set(this)},onBlur:function(a){this.data=this.container.value?this.container.value:this.container.innerHTML;joEvent.stop(a);this.enabled&&(this.blur(),this.changeEvent.fire(this.data))},focus:function(a){if(this.enabled)return joDOM.addCSSClass(this.container,
"focus"),a||this.container.focus(),this},setValue:function(a){this.value=a;this.changeEvent.fire(a);return this},getValue:function(){return this.value},blur:function(){joDOM.removeCSSClass(this.container,"focus");return this},setDataSource:function(a){this.dataSource=a;a.changeEvent.subscribe(this.setData,this);var b=a.getData();this.setData(b!=="undefined"?b:null);this.changeEvent.subscribe(a.setData,a);return this},setValueSource:function(a){this.valueSource=a;a.changeEvent.subscribe(this.setValue,
this);var b=a.getData();this.setValue(b!=="undefined"?b:null);this.selectEvent.subscribe(a.setData,a);return this}});joButton=function(a,b){joControl.apply(this,arguments);this.enabled=!0;if(b)this.container.className=b};
joButton.extend(joControl,{tagName:"jobutton",createContainer:function(){var a=joDOM.create(this.tagName);a&&a.setAttribute("tabindex","1");return a},enable:function(){this.container.setAttribute("tabindex","1");return joControl.prototype.enable.call(this)},disable:function(){this.container.removeAttribute("tabindex");return joControl.prototype.disable.call(this)}});joList=function(){this.setIndex=this.setValue;this.getIndex=this.getValue;joControl.apply(this,arguments)};
joList.extend(joControl,{tagName:"jolist",defaultMessage:"",lastNode:null,value:null,autoSort:!1,setDefault:function(a){this.defaultMessage=a;if(typeof this.data==="undefined"||!this.data||!this.data.length)typeof a==="object"?(this.innerHTML="",a instanceof joView?this.container.appendChild(a.container):a instanceof HTMLElement&&this.container.appendChild(a)):this.innerHTML=a;return this},draw:function(){var a="",b=0;if(typeof this.data==="undefined"||!this.data||!this.data.length){if(this.defaultMessage)this.container.innerHTML=
this.defaultMessage}else{for(var c=0,d=this.data.length;c<d;c++){var e=this.formatItem(this.data[c],c,b);e&&(typeof e==="string"?a+=e:this.container.appendChild(e instanceof joView?e.container:e),++b)}if(a.length)this.container.innerHTML=a;this.value>=0&&this.setValue(this.value,!0)}},deselect:function(){if(typeof this.container!="undefined"&&this.container.childNodes){if(this.getNode(this.value)&&this.lastNode)joDOM.removeCSSClass(this.lastNode,"selected"),this.value=null;return this}},setValue:function(a,
b){this.value=a;if(a!==null){if(typeof this.container==="undefined"||!this.container||!this.container.firstChild)return this;var c=this.getNode(this.value);if(c)this.lastNode&&joDOM.removeCSSClass(this.lastNode,"selected"),joDOM.addCSSClass(c,"selected"),this.lastNode=c;a>=0&&!b&&this.fireSelect(a);return this}},getNode:function(a){return this.container.childNodes[a]},fireSelect:function(a){this.selectEvent.fire(a)},getValue:function(){return this.value},onMouseDown:function(a){joEvent.stop(a);for(var a=
joEvent.getTarget(a),b=-1;b==-1&&a!==this.container;)b=a.getAttribute("index")||-1,a=a.parentNode;b>=0&&this.setValue(b)},refresh:function(){this.autoSort&&this.sort();return joControl.prototype.refresh.apply(this)},getNodeData:function(a){return this.data&&this.data.length&&a>=0&&a<this.data.length?this.data[a]:null},getLength:function(){return this.length||this.data.length||0},sort:function(){this.data.sort(this.compareItems)},getNodeIndex:function(a){a=a.getAttribute("index");return typeof a!==
"undefined"&&a!==null?parseInt(a):-1},formatItem:function(a,b){var c=document.createElement("jolistitem");c.innerHTML=a;c.setAttribute("index",b);return c},compareItems:function(a,b){return a>b?1:a==b?0:-1},setAutoSort:function(a){this.autoSort=a;return this},next:function(){this.getValue()<this.getLength()-1&&this.setValue(this.value+1);return this},prev:function(){this.getValue()>0&&this.setValue(this.value-1);return this}});joBusy=function(a){joContainer.apply(this,arguments)};
joBusy.extend(joContainer,{tagName:"jobusy",draw:function(){this.container.innerHTML="";for(var a=0;a<9;a++)this.container.appendChild(joDom.create("jobusyblock"))},setMessage:function(a){this.message=a||"";return this},setEvents:function(){return this}});joCaption=function(a){joControl.apply(this,arguments)};joCaption.extend(joControl,{tagName:"jocaption"});joCard=function(a){joContainer.apply(this,arguments)};joCard.extend(joContainer,{tagName:"jocard"});
joStack=function(a){this.visible=!1;a&&(a instanceof Array?a.length>1&&(a=[a[0]]):a=[a]);if(this.container&&this.container.firstChild)this.container.innerHTML="";this.setLocked(!0);this.pushEvent=new joSubject(this);this.popEvent=new joSubject(this);this.homeEvent=new joSubject(this);this.showEvent=new joSubject(this);this.hideEvent=new joSubject(this);this.backEvent=new joSubject(this);this.forwardEvent=new joSubject(this);joContainer.call(this,a||[]);this.lastIndex=this.index=0;this.lastNode=null};
joStack.extend(joContainer,{tagName:"jostack",type:"fixed",setEvents:function(){},onClick:function(a){joEvent.stop(a)},forward:function(){this.index<this.data.length-1&&(this.index++,this.draw(),this.forwardEvent.fire());return this},back:function(){this.index>0&&(this.index--,this.draw(),this.backEvent.fire());return this},draw:function(){function a(){b&&(joDOM.removeCSSClass(b,"next"),joDOM.removeCSSClass(b,"prev"),g.removeChild(b));d&&(h&&joEvent.remove(d,"webkitTransitionEnd",h),joDOM.removeCSSClass(d,
"next"),joDOM.removeCSSClass(d,"prev"))}this.container||this.createContainer();if(this.data&&this.data.length){jo.flag.stopback=this.index?!0:!1;var b=this.lastNode,c=this.data[this.index]instanceof joView?this.data[this.index].container:this.data[this.index],d=this.getChildStyleContainer(c);if(d){var e,f;this.index>this.lastIndex?(e="prev",f="next",joDOM.addCSSClass(d,f)):this.index<this.lastIndex&&(e="next",f="prev",joDOM.addCSSClass(d,f));this.appendChild(c);var g=this,h=null;joDefer(function(){typeof window.onwebkittransitionend!==
"undefined"?h=joEvent.on(d,"webkitTransitionEnd",a,g):joDefer(a,this,200);f&&d&&joDOM.removeCSSClass(d,f);e&&b&&joDOM.addCSSClass(b,e)},this,1);typeof this.data[this.index].activate!=="undefined"&&this.data[this.index].activate.call(this.data[this.index]);this.lastIndex=this.index;this.lastNode=d;return this}}},appendChild:function(a){this.container.appendChild(a)},getChildStyleContainer:function(a){return a},getChild:function(){return this.container.firstChild},getContentContainer:function(){return this.container},
removeChild:function(a){a&&a.parentNode===this.container&&this.container.removeChild(a)},isVisible:function(){return this.visible},push:function(a){if(this.data&&this.data.length&&this.data[this.data.length-1]===a)return this;this.data.push(a);this.index=this.data.length-1;this.draw();this.pushEvent.fire(a);return this},setLocked:function(a){this.locked=a?1:0;return this},pop:function(){if(this.data.length>this.locked){var a=this.data.pop();this.index=this.data.length-1;this.draw();typeof a.deactivate===
"function"&&a.deactivate.call(a);this.data.length||this.hide()}this.data.length>0&&this.popEvent.fire();return this},home:function(){if(this.data&&this.data.length&&this.data.length>1){var a=this.data[0];if(a===this.data[this.index])return this;this.data=[a];this.lastIndex=1;this.index=0;this.draw();this.popEvent.fire();this.homeEvent.fire()}return this},showHome:function(){this.home();if(!this.visible)this.visible=!0,joDOM.addCSSClass(this.container,"show"),this.showEvent.fire();return this},getTitle:function(){var a=
this.data[this.index];return typeof a.getTitle==="function"?a.getTitle():!1},show:function(){if(!this.visible)this.visible=!0,joDOM.addCSSClass(this.container,"show"),joDefer(this.showEvent.fire,this.showEvent,500);return this},hide:function(){if(this.visible)this.visible=!1,joDOM.removeCSSClass(this.container,"show"),joDefer(this.hideEvent.fire,this.hideEvent,500);return this}});
joScroller=function(a){this.points=[];this.eventset=!1;this.horizontal=0;this.vertical=1;this.moved=this.inMotion=!1;this.mouseup=this.mousemove=null;this.bumpWidth=this.bumpHeight=0;joContainer.apply(this,arguments)};
joScroller.extend(joContainer,{tagName:"joscroller",velocity:1.6,bumpRatio:0.5,interval:100,transitionEnd:"webkitTransitionEnd",setEvents:function(){joEvent.on(this.container,"mousedown",this.onDown,this)},onFlick:function(){},onClick:function(a){if(this.moved)this.moved=!1,joEvent.stop(a),joEvent.preventDefault(a)},onDown:function(a){this.reset();this.bumpHeight=this.bumpRatio*this.container.offsetHeight;this.bumpWidth=this.bumpRatio*this.container.offsetWidth;var b=this.container.firstChild;joDOM.removeCSSClass(b,
"flick");joDOM.removeCSSClass(b,"flickback");joDOM.removeCSSClass(b,"flickfast");this.start=this.getMouse(a);this.points.unshift(this.start);this.inMotion=!0;if(!this.mousemove)this.mousemove=joEvent.capture(document.body,"mousemove",this.onMove,this),this.mouseup=joEvent.on(document.body,"mouseup",this.onUp,this)},reset:function(){this.points=[];this.inMotion=this.moved=!1},onMove:function(a){if(this.inMotion){joEvent.stop(a);a.preventDefault();var a=this.getMouse(a),b=a.y-this.points[0].y,c=a.x-
this.points[0].x;this.points.unshift(a);this.points.length>7&&this.points.pop();var d=this;this.timer&&window.clearTimeout(this.timer);this.timer=window.setTimeout(function(){d.inMotion&&d.points.length>1&&d.points.pop();d.timer=null},this.interval);this.moved&&this.scrollBy(c,b,!0);if(!this.moved&&this.points.length>3)this.moved=!0}},onUp:function(a){if(this.inMotion){joEvent.remove(document.body,"mousemove",this.mousemove,!0);joEvent.remove(document.body,"mouseup",this.mouseup,!1);this.mousemove=
null;this.inMotion=!1;this.getMouse(a);for(var a=this.container.firstChild,b=this.getTop(),c=this.getLeft(),d=0,e=0,f=0;f<this.points.length-1;f++)d+=this.points[f].y-this.points[f+1].y,e+=this.points[f].x-this.points[f+1].x;var f=0-a.offsetHeight+this.container.offsetHeight,g=0-a.offsetWidth+this.container.offsetWidth;Math.abs(d)*this.vertical>4||Math.abs(e)*this.horizontal>4?(d*=this.velocity*(a.offsetHeight/this.container.offsetHeight),e*=this.velocity*(a.offsetWidth/this.container.offsetWidth),
d+b<f||d+b>0||e+c<g||e+c>0?joDOM.addCSSClass(a,"flickfast"):joDOM.addCSSClass(a,"flick"),this.scrollBy(e,d,!1),joDefer(this.snapBack,this,3E3)):joDefer(this.snapBack,this,10)}},getMouse:function(a){return{x:this.horizontal?a.screenX:0,y:this.vertical?a.screenY:0}},scrollBy:function(a,b){var c=this.container.firstChild,d=this.getTop(),e=this.getLeft(),f=Math.floor(d+b),g=Math.floor(e+a);if(this.vertical&&c.offsetHeight<=this.container.offsetHeight)return this;var h=0-c.offsetHeight+this.container.offsetHeight,
i=0-c.offsetWidth+this.container.offsetWidth;if(this.bumpHeight)f>this.bumpHeight?f=this.bumpHeight:f<h-this.bumpHeight&&(f=h-this.bumpHeight);if(this.bumpWidth)g>this.bumpWidth?g=this.bumpWidth:f<i-this.bumpWidth&&(g=i-this.bumpWidth);if(!this.eventset)this.eventset=joEvent.capture(c,this.transitionEnd,this.snapBack,this);(d!=g||e!=f)&&this.moveTo(g,f);return this},scrollTo:function(a,b){var c=this.container.firstChild;if(!c)return this;if(typeof a==="object"){var d;if(a instanceof HTMLElement)d=
a;else if(a instanceof joView)d=a.container;var e=0-d.offsetTop;d=d.offsetHeight+80;var f=this.getTop(),g=f-this.container.offsetHeight,a=f;e-d<g&&(a=e-d+this.container.offsetHeight);a<e&&(a=e)}a<0-c.offsetHeight?a=0-c.offsetHeight:a>0&&(a=0);b?(joDOM.removeCSSClass(c,"flick"),joDOM.removeCSSClass(c,"flickback")):joDOM.addCSSClass(c,"flick");this.moveTo(0,a);return this},snapBack:function(){var a=this.container.firstChild,b=this.getTop(),c=this.getLeft(),d=b,e=c,f=0-a.offsetHeight+this.container.offsetHeight,
g=0-a.offsetWidth+this.container.offsetWidth;this.eventset&&joEvent.remove(a,this.transitionEnd,this.eventset);this.eventset=null;joDOM.removeCSSClass(a,"flick");d>0?d=0:d<f&&(d=f);e>0?e=0:e<g&&(e=g);if(e!=c||d!=b)joDOM.addCSSClass(a,"flickback"),this.moveTo(e,d)},setScroll:function(a,b){this.horizontal=a?1:0;this.vertical=b?1:0;return this},moveTo:function(a,b){var c=this.container.firstChild;if(!c)return this;this.setPosition(a*this.horizontal,b*this.vertical,c);c.jotop=b;c.joleft=a},setPosition:function(a,
b,c){c.style.webkitTransform="translate3d("+a+"px, "+b+"px, 0)";return this},getTop:function(){return this.container.firstChild.jotop||0},getLeft:function(){return this.container.firstChild.joleft||0},setData:function(a){return joContainer.prototype.setData.apply(this,arguments)}});joDivider=function(a){joView.apply(this,arguments)};joDivider.extend(joView,{tagName:"jodivider"});joExpando=function(a){this.openEvent=new joSubject(this);this.closeEvent=new joSubject(this);joContainer.apply(this,arguments)};
joExpando.extend(joContainer,{tagName:"joexpando",draw:function(){this.data&&this.container&&(joContainer.prototype.draw.apply(this,arguments),this.setToggleEvent())},setEvents:function(){},setToggleEvent:function(){joEvent.on(this.container.childNodes[0],"click",this.toggle,this)},toggle:function(){return this.container.className.indexOf("open")>=0?this.close():this.open()},open:function(){joDOM.addCSSClass(this.container,"open");this.openEvent.fire();return this},close:function(){joDOM.removeCSSClass(this.container,
"open");this.closeEvent.fire();return this}});joExpandoContent=function(){joContainer.apply(this,arguments)};joExpandoContent.extend(joContainer,{tagName:"joexpandocontent"});joExpandoTitle=function(a){joControl.apply(this,arguments)};joExpandoTitle.extend(joControl,{tagName:"joexpandotitle",setData:function(){joView.prototype.setData.apply(this,arguments);this.draw();return this},draw:function(){if(this.data&&this.container)this.container.innerHTML=this.data+"<joicon></joicon>"}});
joFlexrow=function(a){joContainer.apply(this,arguments)};joFlexrow.extend(joContainer,{tagName:"joflexrow"});joFlexcol=function(a){joContainer.apply(this,arguments)};joFlexcol.extend(joContainer,{tagName:"joflexcol"});joFocus={last:null,set:function(a){this.last&&this.last!==a&&this.last.blur();if(a&&a instanceof joControl)a.focus(),this.last=a},get:function(){return this.last},refresh:function(){this.last&&this.last.focus()},clear:function(){this.set()}};
joFooter=function(a){joContainer.apply(this,arguments)};joFooter.extend(joContainer,{tagName:"jofooter"});
joGesture={load:function(){this.upEvent=new joSubject(this);this.downEvent=new joSubject(this);this.leftEvent=new joSubject(this);this.rightEvent=new joSubject(this);this.forwardEvent=new joSubject(this);this.defaultEvent=new joSubject(this);this.backEvent=new joSubject(this);this.homeEvent=new joSubject(this);this.closeEvent=new joSubject(this);this.activateEvent=new joSubject(this);this.deactivateEvent=new joSubject(this);this.resizeEvent=new joSubject(this);this.setEvents()},setEvents:function(){joEvent.on(document.body,
"keydown",this.onKeyDown,this);joEvent.on(document.body,"keyup",this.onKeyUp,this);joEvent.on(document.body,"unload",this.closeEvent,this);joEvent.on(window,"activate",this.activateEvent,this);joEvent.on(window,"deactivate",this.deactivateEvent,this);joEvent.on(window,"resize",this.resize,this)},resize:function(){this.resizeEvent.fire(window)},onKeyUp:function(a){if(!a)a=window.event;if(a.keyCode==18)this.altkey=!1;else if(a.keyCode==27)jo.flag.stopback&&(joEvent.stop(a),joEvent.preventDefault(a)),
this.backEvent.fire("back");else if(a.keyCode==13)joEvent.stop(a),joEvent.preventDefault(a),this.defaultEvent.fire("default");else if(this.altkey)switch(joEvent.stop(a),a.keyCode){case 37:this.leftEvent.fire("left");break;case 38:this.upEvent.fire("up");break;case 39:this.rightEvent.fire("right");break;case 40:this.downEvent.fire("down");break;case 27:this.backEvent.fire("back");break;case 13:this.forwardEvent.fire("forward")}},onKeyDown:function(a){if(!a)a=window.event;if(a.keyCode==27)joEvent.stop(a),
joEvent.preventDefault(a);else if(a.keyCode==13&&joFocus.get()instanceof joInput)joEvent.stop(a);else if(a.keyCode==18)this.altkey=!0}};joGroup=function(a){joContainer.apply(this,arguments)};joGroup.extend(joContainer,{tagName:"jogroup"});joHTML=function(a){joControl.apply(this,arguments)};
joHTML.extend(joControl,{tagName:"johtml",setEvents:function(){joEvent.on(this.container,"click",this.onClick,this)},onClick:function(a){function b(a){return!a?null:a.href?a:typeof a.parentNode!=="undefined"&&a.parentNode!==c?b(a.parentNode):null}joEvent.stop(a);joEvent.preventDefault(a);var c=this.container;(a=b(joEvent.getTarget(a)))&&this.selectEvent.fire(a.href)}});joInput=function(a){joControl.apply(this,arguments)};
joInput.extend(joControl,{tagName:"input",type:"text",setData:function(a){if(a!==this.data)this.data=a,typeof this.container.value!=="undefined"?this.container.value=a:this.container.innerHTML=a,this.changeEvent.fire(this.data);return this},getData:function(){return typeof this.container.value!=="undefined"?this.container.value:this.container.innerHTML},enable:function(){this.container.setAttribute("tabindex","1");return joControl.prototype.enable.call(this)},disable:function(){this.container.removeAttribute("tabindex");
return joControl.prototype.disable.call(this)},createContainer:function(){var a=joDOM.create(this);if(a)return a.setAttribute("type","text"),a.setAttribute("tabindex","1"),a.contentEditable=this.enabled,a},setEvents:function(){this.container&&(joControl.prototype.setEvents.call(this),joEvent.on(this.container,"keydown",this.onKeyDown,this))},onKeyDown:function(a){a.keyCode==13&&(a.preventDefault(),joEvent.stop(a));return!1},draw:function(){this.container.value?this.value=this.data:this.innerHTML=
this.value},onMouseDown:function(a){joEvent.stop(a);this.focus()},storeData:function(){this.data=this.getData();this.dataSource&&this.dataSource.set(this.value)}});joLabel=function(a){joControl.apply(this,arguments)};joLabel.extend(joControl,{tagName:"jolabel"});joMenu=function(){joList.apply(this,arguments)};
joMenu.extend(joList,{tagName:"jomenu",itemTagName:"jomenuitem",value:null,fireSelect:function(a){typeof this.data[a].id!=="undefined"&&this.data[a].id?this.selectEvent.fire(this.data[a].id):this.selectEvent.fire(a)},formatItem:function(a,b){var c=joDOM.create(this.itemTagName);c.setAttribute("index",b);if(typeof a==="object"){if(c.innerHTML=a.title,a.icon)c.style.backgroundImage="url("+a.icon+")",joDOM.addCSSClass(c,"icon")}else c.innerHTML=a;return c}});joOption=function(){joMenu.apply(this,arguments)};
joOption.extend(joMenu,{tagName:"jooption",itemTagName:"jooptionitem"});joPasswordInput=function(a){joInput.apply(this,arguments)};joPasswordInput.extend(joInput,{className:"password",type:"password"});joPopup=function(){this.showEvent=new joSubject(this);this.hideEvent=new joSubject(this);joContainer.apply(this,arguments)};
joPopup.extend(joContainer,{tagName:"jopopup",setEvents:function(){joEvent.on(this.container,"mousedown",this.onClick,this)},onClick:function(a){joEvent.stop(a)},hide:function(){joEvent.on(this.container,"webkitTransitionEnd",this.onHide,this);this.container.className="hide";return this},onHide:function(){this.hideEvent.fire()},show:function(){this.container.className="show";this.showEvent.fire();return this}});
joScreen=function(){this.resizeEvent=new joSubject(this);this.menuEvent=new joSubject(this);this.activateEvent=new joSubject(this);this.deactivateEvent=new joSubject(this);this.backEvent=new joSubject(this);this.forwardEvent=new joSubject(this);joContainer.apply(this,arguments)};
joScreen.extend(joContainer,{tagName:"screen",setupEvents:function(){joEvent.on(window,"resize",this.resizeEvent.fire,this);joEvent.on(window,"appmenushow",this.menuEvent.fire,this);joEvent.on(window,"activate",this.activateEvent.fire,this);joEvent.on(window,"deactivate",this.deactivateEvent.fire,this);joEvent.on(window,"back",this.backEvent.fire,this)},createContainer:function(){return document.body},showPopup:function(a){this.popup?this.popup.setData(a):this.shim=new joShim(new joFlexcol(["&nbsp",
this.popup=new joPopup(a),"&nbsp"]));this.shim.show();this.popup.show();return this},hidePopup:function(){this.shim&&this.shim.hide();return this},alert:function(a,b,c,d){function e(a){a||(a={label:"OK"});var b=new joButton(a.label);b.selectEvent.subscribe(function(){a.action&&a.action.call(a.context);i.hidePopup();g&&(d?g.call(d):g())},a.context||i);f.push(b)}var f=[],g,d=typeof d==="object"?d:null;if(typeof c==="object")if(c instanceof Array)for(var h=0;h<c.length;h++)e(c[h]);else e(c);else typeof c===
"string"?e({label:c}):(typeof c==="function"&&(g=c),e());this.showPopup([new joTitle(a),new joHTML(b),f]);var i=this;return this}});joShim=function(){this.showEvent=new joSubject(this);this.hideEvent=new joSubject(this);this.selectEvent=new joSubject(this);joContainer.apply(this,arguments)};
joShim.extend(joContainer,{tagName:"joshim",setEvents:function(){joEvent.on(this.container,"mousedown",this.onMouseDown,this)},onMouseDown:function(a){joEvent.stop(a);this.hide()},hide:function(){this.container.className="";joEvent.on(this.container,"webkitTransitionEnd",this.onHide,this);return this},show:function(){this.attach();this.container.className="show";joEvent.on(this.container,"webkitTransitionEnd",this.onShow,this);if(!this.lastParent)this.lastParent=document.body;return this},onShow:function(){this.showEvent.fire()},
onHide:function(){this.detach();this.hideEvent.fire()}});joSound=function(a,b){this.endedEvent=new joSubject(this);this.errorEvent=new joSubject(this);if(typeof Audio!="undefined")this.filename=a,this.audio=new Audio,this.audio.autoplay=!1,this.audio&&(joDefer(function(){this.audio.src=a;this.audio.load()},this,5),this.setRepeatCount(b),joEvent.on(this.audio,"ended",this.onEnded,this))};
joSound.prototype={play:function(){if(this.audio&&this.audio.volume!==0)return this.audio.play(),this},onEnded:function(){this.endedEvent.fire(this.repeat);++this.repeat<this.repeatCount?this.play():this.repeat=0},setRepeatCount:function(a){this.repeatCount=a;this.repeat=0;return this},pause:function(){if(this.audio)return this.audio.pause(),this},rewind:function(){if(this.audio){try{this.audio.currentTime=0}catch(a){joLog("joSound: can't rewind...")}this.repeat=0;return this}},stop:function(){this.pause();
this.rewind();this.repeat=0;return this},setVolume:function(a){if(this.audio&&!(a<0||a>1))return this.audio.volume=a,this}};joStackScroller=function(a){this.scrollers=[new joScroller,new joScroller];this.scroller=this.scrollers[0];joStack.apply(this,arguments);this.scroller.attach(this.container)};
joStackScroller.extend(joStack,{type:"scroll",scrollerindex:1,scroller:null,scrollers:[],switchScroller:function(){this.scrollerindex=this.scrollerindex?0:1;this.scroller=this.scrollers[this.scrollerindex]},getLastScroller:function(){return this.scrollers[this.scrollerindex?0:1]},scrollTo:function(a){this.scroller.scrollTo(a);return this},scrollBy:function(a){this.scroller.scrollBy(a);return this},getChildStyleContainer:function(){return this.scroller.container},getContentContainer:function(){return this.scroller.container},
appendChild:function(a){var b=this.scroller;b.setData(a);this.container.appendChild(b.container)},getChild:function(){return this.scroller.container||null},forward:function(){this.index<this.data.length-1&&this.switchScroller();joStack.prototype.forward.call(this);return this},back:function(){this.index>0&&this.switchScroller();joStack.prototype.forward.call(this);return this},home:function(){this.data&&this.data.length&&this.data.length>1&&(this.switchScroller(),joStack.prototype.home.call(this));
return this},push:function(a){if(!this.data||!(this.data.length&&this.data[this.data.length-1]===a))return this.switchScroller(),joDOM.removeCSSClass(a,"flick"),joDOM.removeCSSClass(a,"flickback"),this.scroller.setData(a),this.scroller.scrollTo(0,!0),joStack.prototype.push.call(this,a),this},pop:function(){this.data.length>this.locked&&this.switchScroller();joStack.prototype.pop.call(this);return this}});joTabBar=function(){joList.apply(this,arguments)};
joTabBar.extend(joList,{tagName:"jotabbar",formatItem:function(a,b){var c=document.createElement("jotab");if(a.label)c.innerHTML=a.label;if(a.type)c.className=a.type;c.setAttribute("index",b);return c}});joTable=function(a){joList.apply(this,arguments)};
joTable.extend(joList,{tagName:"jotable",formatItem:function(a,b){for(var c=document.createElement("tr"),d=0,e=a.length;d<e;d++){var f=document.createElement(b?"td":"th");f.innerHTML=a[d];f.setAttribute("index",b*e+d);c.appendChild(f)}return c},getNode:function(a){var b=this.getRow(a),a=this.getCol(a);return this.container.childNodes[b].childNodes[a]},getRow:function(a){typeof a==="undefined"&&(a=this.getIndex());return Math.floor(a/this.data[0].length)},getCol:function(a){typeof a==="undefined"&&
(a=this.getIndex());return a%this.data[0].length}});joTextarea=function(a){joInput.apply(this,arguments)};joTextarea.extend(joInput,{tagName:"textarea",onKeyDown:function(){return!1}});joTitle=function(a){joView.apply(this,arguments)};joTitle.extend(joView,{tagName:"jotitle"});joToolbar=function(a){joContainer.apply(this,arguments)};joToolbar.extend(joContainer,{tagName:"jotoolbar"});joForm=function(){joContainer.apply(this,arguments)};joForm.extend(joContainer,{tagName:"form"});
joDialog=function(a){joShim.call(this,new joFlexcol(["",(new joPopup(new joScroller(a))).setStyle("show"),""]))};joDialog.extend(joShim,{});joSelectList=function(){joList.apply(this,arguments)};joSelectList.extend(joList,{tagName:"joselectlist"});joNavbar=function(a){if(a)this.firstTitle=a;a=[this.titlebar=(new joView(a||"&nbsp;")).setStyle("title"),new joFlexrow([this.back=(new joBackButton("Back")).selectEvent.subscribe(this.back,this),""])];joContainer.call(this,a)};
joNavbar.extend(joContainer,{tagName:"jonavbar",stack:null,back:function(){this.stack&&this.stack.pop();return this},setStack:function(a){this.stack&&(this.stack.pushEvent.unsubscribe(this.update,this),this.stack.popEvent.unsubscribe(this.update,this));if(!a)return this.stack=null,this;this.stack=a;a.pushEvent.subscribe(this.update,this);a.popEvent.subscribe(this.update,this);this.refresh();return this},update:function(){if(!this.stack)return this;joDOM.removeCSSClass(this.back,"selected");joDOM.removeCSSClass(this.back,
"focus");this.stack.data.length>1?joDOM.addCSSClass(this.back,"active"):joDOM.removeCSSClass(this.back,"active");var a=this.stack.getTitle();typeof a==="string"?this.titlebar.setData(a):this.titlebar.setData(this.firstTitle);return this},setTitle:function(a){this.titlebar.setData(a);this.firstTitle=a;return this}});joBackButton=function(){joButton.apply(this,arguments)};joBackButton.extend(joButton,{tagName:"jobackbutton"});
joSelect=function(a,b){var c=b;b instanceof joDataSource&&(c=b.getData());c=[this.field=new joSelectTitle(c),this.list=new joSelectList(a,b)];this.field.setList(this.list);this.changeEvent=this.list.changeEvent;this.selectEvent=this.list.selectEvent;joExpando.call(this,c);this.container.setAttribute("tabindex",1);this.field.setData(this.list.value);this.list.selectEvent.subscribe(this.setValue,this)};
joSelect.extend(joExpando,{setValue:function(a,b){b?(this.field.setData(a),this.close()):this.field.setData(a);return this},getValue:function(){return this.list.getValue()},setEvents:function(){joControl.prototype.setEvents.call(this)},onBlur:function(a){joEvent.stop(a);joDOM.removeCSSClass(this,"focus");this.close()}});joSelectTitle=function(){joExpandoTitle.apply(this,arguments)};
joSelectTitle.extend(joExpandoTitle,{list:null,setList:function(a){this.list=a;return this},setData:function(a){this.list?joExpandoTitle.prototype.setData.call(this,this.list.getNodeData(a)||"Select..."):joExpandoTitle.prototype.setData.call(this,a);return this}});joToggle=function(a){joControl.call(this,a)};
joToggle.extend(joControl,{tagName:"jotoggle",button:null,labels:["Off","On"],setLabels:function(a){if(a instanceof Array)this.labels=a;else if(arguments.length==2)this.labels=arguments;this.draw();return this},select:function(a){a&&joEvent.stop(a);this.setData(this.data?!1:!0);return this},onBlur:function(a){joEvent.stop(a);this.blur()},draw:function(){if(this.container){if(!this.container.firstChild)this.button=joDOM.create("div"),this.container.appendChild(this.button);this.button.innerHTML=this.labels[this.data?
1:0];this.data?joDOM.addCSSClass(this.container,"on"):joDOM.removeCSSClass(this.container,"on")}}});joSlider=function(a){this.min=0;this.max=1;this.snap=0;this.range=1;this.thumb=null;this.horizontal=1;this.vertical=0;this.moved=!1;this.jump=!0;this.slideStartEvent=new joSubject;this.slideEndEvent=new joSubject;joControl.call(this,null,a)};
joSlider.extend(joControl,{tagName:"joslider",setRange:function(a,b,c){if(a>=b)return joLog("WARNING: joSlider.setRange, min must be less than max."),this;this.min=a||0;this.max=b||1;this.range=a<0&&b>=0?Math.abs(a)+b:a<0&&b<=0?a-b:b-a;this.snap=typeof c!=="undefined"?c>=0&&c<=this.range?c:0:0;this.setValue(this.value);return this},setValue:function(a,b){var c=this.adjustValue(a);c!=this.value&&(joControl.prototype.setValue.call(this,c),b||this.draw());return this},adjustValue:function(a){this.snap&&
(a=Math.floor(a/this.snap)*this.snap);if(a<this.min)a=this.min;else if(a>this.max)a=this.max;return a},createContainer:function(){var a=joDOM.create(this.tagName);a&&a.setAttribute("tabindex","1");var b=joDOM.create("josliderthumb");a.appendChild(b);this.thumb=b;return a},onDown:function(a){joEvent.stop(a);this.reset();this.inMotion=!0;this.moved=!1;this.slideStartEvent.fire(this.value);if(!this.mousemove)this.mousemove=joEvent.on(document.body,"mousemove",this.onMove,this),this.mouseup=joEvent.capture(document.body,
"mouseup",this.onUp,this)},reset:function(){this.inMotion=this.moved=!1;this.firstY=this.firstX=-1},onMove:function(a){if(this.inMotion){joEvent.stop(a);a.preventDefault();var b=this.getMouse(a),a=b.y,b=b.x;if(this.firstX==-1)this.firstX=b,this.firstY=a,this.ox=this.thumb.offsetLeft,this.oy=this.thumb.offsetTop;b=b-this.firstX+this.ox;a=a-this.firstY+this.oy;if(b>4||a>4)this.moved=!0;a=this.container.offsetWidth-this.thumb.offsetWidth;b<0?b=0:b>a&&(b=a);this.snap||this.moveTo(b);this.setValue(b/a*
this.range+this.min,!this.snap)}},moveTo:function(a){this.thumb.style.left=a+"px";return this},initValue:function(){console.log(this.container);if(!this.container)return this;var a=this.container.offsetWidth-this.container.firstChild.offsetWidth;this.moveTo(Math.floor(Math.abs(this.min-this.value)/this.range*a));return this},onUp:function(a){if(this.inMotion)joEvent.remove(document.body,"mousemove",this.mousemove),joEvent.remove(document.body,"mouseup",this.mouseup,!0),this.mousemove=null,joEvent.stop(a),
joEvent.preventDefault(a),joDefer(function(){this.reset();this.slideEndEvent.fire(this.value)},this)},setEvents:function(){joEvent.on(this.container,"click",this.onClick,this);joEvent.on(this.thumb,"mousedown",this.onDown,this);joGesture.resizeEvent.subscribe(this.draw,this)},onClick:function(a){if(!this.inMotion&&!this.moved){joEvent.stop(a);joEvent.preventDefault(a);var a=this.getMouse(a),a=Math.floor(a.x),b=this.thumb.offsetWidth;a-=b;var c=this.container.offsetWidth-b;a<b&&this.snap||a<0?a=0:
a>c&&(a=c);this.setValue(a/c*this.range+this.min)}},getMouse:function(a){return{x:this.horizontal?a.screenX:0,y:this.vertical?a.screenY:0}},draw:function(){this.container&&this.initValue(this.getValue())}});