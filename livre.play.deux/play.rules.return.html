<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Play.Rules Return</title>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #dddddd; }
td.sourceCode { padding-left: 5px; }
code > span.kw { font-weight: bold; }
code > span.dt { color: #800000; }
code > span.dv { color: #0000ff; }
code > span.bn { color: #0000ff; }
code > span.fl { color: #800080; }
code > span.ch { color: #ff00ff; }
code > span.st { color: #dd0000; }
code > span.co { color: #808080; font-style: italic; }
code > span.al { color: #00ff00; font-weight: bold; }
code > span.fu { color: #000080; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div id="header">
<h1 class="title">Play.Rules Return</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#remerciements">Remerciements</a></li>
<li><a href="#préface">Préface</a></li>
<li><a href="#play2-1ers-contacts">Play2!&gt; 1ers contacts</a></li>
<li><a href="#play2-initiation">Play2!&gt; Initiation</a><ul>
<li><a href="#play2">Play2!&gt; ???</a></li>
<li><a href="#objectif">Objectif</a></li>
<li><a href="#installation">Installation</a><ul>
<li><a href="#modification-du-path">Modification du PATH</a><ul>
<li><a href="#sous-osx-linux">Sous OSX (&amp; Linux)</a></li>
<li><a href="#sous-windows">Sous Windows</a></li>
<li><a href="#on-vérifie">On vérifie</a></li>
</ul></li>
</ul></li>
<li><a href="#ère-application">1ère application</a><ul>
<li><a href="#génération-du-squelette-de-lapplication">Génération du squelette de l'application</a><ul>
<li><a href="#allons-voir-ce-qui-a-été-généré">Allons voir ce qui a été généré :</a></li>
<li><a href="#allez-on-lance">Allez on lance ?</a></li>
</ul></li>
</ul></li>
<li><a href="#paramétrage-de-lide-intellij-ce">Paramétrage de l'IDE : IntelliJ CE</a></li>
<li><a href="#paramétrage-de-notre-application">Paramétrage de notre application</a><ul>
<li><a href="#il-nous-faut-une-base-de-données">Il nous faut une base de données</a></li>
<li><a href="#il-va-nous-falloir-des-modèles">Il va nous falloir des modèles</a></li>
</ul></li>
<li><a href="#les-modèles">Les modèles</a><ul>
<li><a href="#création-dun-1er-modèle-category">Création d'un 1er modèle : Category</a></li>
<li><a href="#création-dun-2ème-modèle-bookmark">Création d'un 2ème modèle : Bookmark</a></li>
<li><a href="#mettez-à-jour-category.java">Mettez à jour Category.java :</a></li>
</ul></li>
<li><a href="#contrôleurs">Contrôleurs</a><ul>
<li><a href="#création-dun-contrôleur-bookmarks">Création d'un Contrôleur : Bookmarks</a><ul>
<li><a href="#explications">Explications :</a></li>
<li><a href="#modification-du-fichier-routes">Modification du fichier routes</a></li>
</ul></li>
<li><a href="#contrôleur-categories">Contrôleur Categories :</a><ul>
<li><a href="#fichier-routes">Fichier &quot;routes&quot;</a></li>
</ul></li>
<li><a href="#modification-du-contrôleur-application">Modification du Contrôleur Application :</a></li>
</ul></li>
<li><a href="#vues">Vues</a><ul>
<li><a href="#modification-de-la-vue-principale-index.scala.html">Modification de la vue principale : index.scala.html</a></li>
</ul></li>
<li><a href="#allez-un-peu-de-js-des-services-maintenant">Allez un peu de JS &amp; des services maintenant !</a><ul>
<li><a href="#obtenir-la-liste-des-catégories">Obtenir la liste des catégories</a></li>
<li><a href="#obtenir-la-liste-des-bookmarks">Obtenir la liste des bookmarks</a></li>
<li><a href="#ajouter-une-catégorie">Ajouter une catégorie</a></li>
</ul></li>
<li><a href="#cest-tout-pour-cette-partie">C'est tout pour cette partie</a></li>
</ul></li>
</ul>
</div>
<div class="figure">
<img src="rsrc/play.rules.return.png" /><p class="caption"></p>
</div>
<h2 id="remerciements"><a href="#TOC">Remerciements</a></h2>
<h1 id="préface"><a href="#TOC">Préface</a></h1>
<h1 id="play2-1ers-contacts"><a href="#TOC">Play2!&gt; 1ers contacts</a></h1>
<h1 id="play2-initiation"><a href="#TOC">Play2!&gt; Initiation</a></h1>
<p>version du moment : RC2/RC3</p>
<h2 id="play2"><a href="#TOC">Play2!&gt; ???</a></h2>
<pre><code>//TODO : petit blabla, version java, version scala, les +, les -, etc. ...</code></pre>
<h2 id="objectif"><a href="#TOC">Objectif</a></h2>
<p>Pas forcément tout voir, je ne vais pas traiter des templates pour cette 1ère fois</p>
<h2 id="installation"><a href="#TOC">Installation</a></h2>
<ul>
<li>attention, vous devez avoir le JDK 6 minimum (Eh oui, vous avez le 7 aussi) : donc attention à ne pas proposer Play2 à des clients étant encore en JDK 5 (si, ça existe encore !)</li>
<li>télécharger Play2!&gt; : <a href="http://www.playframework.org/2.0">http://www.playframework.org/2.0</a></li>
<li>dézipper quelque part</li>
</ul>
<h3 id="modification-du-path"><a href="#TOC">Modification du PATH</a></h3>
<h4 id="sous-osx-linux"><a href="#TOC">Sous OSX (&amp; Linux)</a></h4>
<pre><code>sudo pico ~/.bash_profile
export PATH=$PATH:/ENDROIT_OU_VOUS_AVEZ_DEZIPPE/play-2.0-RC2</code></pre>
<p>Si vous continuez à jouer avec Play1!&gt; (ce qui est mon cas), dans <code>play-2.0-RC2</code> renommez <code>play</code> en <code>play2</code></p>
<p><em>Remarque : vérifier si le script &quot;play&quot; ou &quot;play2&quot; est exécutable. Sinon tapez <code>chmod a+x play</code> ou <code>chmod a+x play2</code>.</em></p>
<h4 id="sous-windows"><a href="#TOC">Sous Windows</a></h4>
<pre><code>//TODO</code></pre>
<h4 id="on-vérifie"><a href="#TOC">On vérifie</a></h4>
<p>Dans une nouvelle fenêtre de Terminal ou de Console, tapez :</p>
<pre><code>play help</code></pre>
<p>ou (si vous avez suivi)</p>
<pre><code>play2 help</code></pre>
<p>Cela va mouliner un peu : Play2!&gt; télécharge quelques dépendances :</p>
<div class="figure">
<img src="rsrc/part00-ch00.001.png" /><p class="caption"></p>
</div>
<p>Voilà, ça c'est fait, on peut commencer.</p>
<p><em>Remarque : il existe une autre méthode d'installation à partir de sbt</em></p>
<pre><code>//TODO : à développer</code></pre>
<h2 id="ère-application"><a href="#TOC">1ère application</a></h2>
<p>Qu'allons nous faire ? ... Des bookmarks, encore des bookmarks</p>
<pre><code>//TODO</code></pre>
<h3 id="génération-du-squelette-de-lapplication"><a href="#TOC">Génération du squelette de l'application</a></h3>
<ul>
<li>Installez vous dans votre répertoire de travail (<code>cd mon_repertoire_de_travail</code>)</li>
<li>Tapez la commande <code>play new bookmarks</code></li>
<li>validez et suivez les instructions</li>
</ul>
<p>Play vous propose un nom par défaut pour votre application : acceptez</p>
<div class="figure">
<img src="rsrc/part00-ch00.002.png" /><p class="caption"></p>
</div>
<p>Play vous demande quel type de projet vous souhaitez générer, choisissez la version Java</p>
<div class="figure">
<img src="rsrc/part00-ch00.003.png" /><p class="caption"></p>
</div>
<p>Et hop, c'est fait</p>
<div class="figure">
<img src="rsrc/part00-ch00.004.png" /><p class="caption"></p>
</div>
<h4 id="allons-voir-ce-qui-a-été-généré"><a href="#TOC">Allons voir ce qui a été généré :</a></h4>
<p>Un répertoire <code>bookmarks</code> a été créé avec ceci &quot;à l'intérieur&quot; :</p>
<div class="figure">
<img src="rsrc/part00-ch00.005.png" /><p class="caption"></p>
</div>
<p><strong>Mais où est passé le répertoire <code>models</code> ???</strong></p>
<h4 id="allez-on-lance"><a href="#TOC">Allez on lance ?</a></h4>
<ul>
<li><code>cd bookmarks</code></li>
<li><code>play</code> (ou <code>play2</code>)</li>
</ul>
<p>Cela risque de &quot;mouliner&quot; un moment la 1ère fois, Play2!&gt; a pas mal de dépendances à charger. Et vous arrivez enfin dans la console Play :</p>
<div class="figure">
<img src="rsrc/part00-ch00.006.png" /><p class="caption"></p>
</div>
<p>Tapez <code>run</code></p>
<div class="figure">
<img src="rsrc/part00-ch00.007.png" /><p class="caption"></p>
</div>
<p>Et allons voir du côté de notre navigateur préféré, ouvrons <a href="http://localhost:9000">http://localhost:9000</a> :</p>
<p>En parallèle, côté console (côté serveur), ça compile :</p>
<div class="figure">
<img src="rsrc/part00-ch00.008.png" /><p class="caption"></p>
</div>
<p>Et au bout de quelques instants, si tout va bien, vous obtenez cette page dans votre navigateur :</p>
<div class="figure">
<img src="rsrc/part00-ch00.009.png" /><p class="caption"></p>
</div>
<p>Nous avons donc une installation de Play2!&gt; et un squelette d'application opérationnels. Avant d'aller plus loin, nous allons paramétrer un IDE pour nous faciliter le développement (il est aussi possible d'utiliser un simple éditeur de texte). Play2!&gt; peut fonctionner avec plusieurs IDE :</p>
<ul>
<li>Eclipse</li>
<li>IntelliJ</li>
<li>NetBeans (il reste à ce jour encore quelques réglages/développements à réaliser)</li>
</ul>
<p>Je vous propose d'utiliser la version Community d'IntelliJ (qui semble faite pour Play), qui a l'avantage d'être gratuite et puissante à la fois.</p>
<h2 id="paramétrage-de-lide-intellij-ce"><a href="#TOC">Paramétrage de l'IDE : IntelliJ CE</a></h2>
<ul>
<li>Quittez la console play : <code>Ctrl+c</code></li>
<li>relancez <code>play</code> (ou <code>play2</code>) (toujours dans le répertoire de votre application)</li>
<li>une fois que vous êtes au prompt <code>[bookmarks] $</code>, tapez la commande <code>idea</code> et validez</li>
</ul>
<p>Vous devriez obtenir ceci :</p>
<div class="figure">
<img src="rsrc/part00-ch00.010.png" /><p class="caption"></p>
</div>
<p>Play a généré dans le répertoire de l'application un fichier <code>bookmarks.iml</code></p>
<ul>
<li>Démarrez IntelliJ</li>
<li>Créez un nouveau projet</li>
<li>Choisir &quot;Create project from scratch&quot;</li>
<li>donnez un nom au projet (j'ai choisi de lui donner le même nom que mon application : <code>bookmarks</code>)</li>
<li>faire pointer &quot;Project files location&quot; sur le répertoire de votre application (dans mon cas cela donnerait <code>/Users/k33g_org/Dropbox/play_2/bookmarks</code>)</li>
<li>décochez l'option &quot;Create module&quot;</li>
<li>cliquez sur &quot;Finish&quot;</li>
</ul>
<p>IntelliJ va vous afficher une fenêtre &quot;Project Structure&quot; :</p>
<ul>
<li>Dans la rubrique &quot;Modules&quot; de &quot;Projects Settings&quot;, ajoutez un module (l'icone &quot;+&quot;)</li>
<li>Sélectionnez le choix &quot;import existing module&quot;</li>
<li>&quot;pointez&quot; vers le fichier <code>bookmarks.iml</code> (cans mon cas <code>/Users/k33g_org/Dropbox/play_2/bookmarks/bookmarks.iml</code>)</li>
<li>cliquez sur &quot;Finish&quot;</li>
</ul>
<p>Vous devriez obtenir l'écran suivant (si vous avez tout fait comme il faut) :</p>
<div class="figure">
<img src="rsrc/part00-ch00.011.png" /><p class="caption"></p>
</div>
<ul>
<li>cliquez sur &quot;OK&quot;</li>
</ul>
<p>Voilà, vous avez un projet IntelliJ pour votre application</p>
<div class="figure">
<img src="rsrc/part00-ch00.012.png" /><p class="caption"></p>
</div>
<p>Si vraiment vous souhaitez utiliser un autre IDE, c'est expliqué ici : <a href="https://github.com/playframework/Play20/wiki/IDE">https://github.com/playframework/Play20/wiki/IDE</a></p>
<h2 id="paramétrage-de-notre-application"><a href="#TOC">Paramétrage de notre application</a></h2>
<h3 id="il-nous-faut-une-base-de-données"><a href="#TOC">Il nous faut une base de données</a></h3>
<p>Allons faire un tour dans le fichier <code>conf/application.conf</code> et ajoutons ceci :</p>
<pre><code>db.default.driver=org.h2.Driver
db.default.url=&quot;jdbc:h2:file:play&quot;</code></pre>
<p>au niveau de la section :</p>
<pre><code># Database configuration
# ~~~~~ </code></pre>
<p>Nous avons donc expliqué à Play, que nous souhaitions utiliser la base de données &quot;H2 Database&quot; en mode fichier. Comme cela toutes nos modifications seront persistées.</p>
<h3 id="il-va-nous-falloir-des-modèles"><a href="#TOC">Il va nous falloir des modèles</a></h3>
<ul>
<li>créez un répertoire <code>models</code> dans <code>app</code> car ça n'est pas fait automatiquement (pour le moment ?) (dans IntelliJ, utilisez la fonction &quot;New Package&quot;</li>
<li>dans <code>conf/application.conf</code> modifiez la partie <code># Ebean configuration</code> : Décommentez la ligne : <code>ebean.default=models.*</code></li>
</ul>
<h2 id="les-modèles"><a href="#TOC">Les modèles</a></h2>
<pre><code>//TODO : blabla ebean</code></pre>
<h3 id="création-dun-1er-modèle-category"><a href="#TOC">Création d'un 1er modèle : Category</a></h3>
<p>Créer une classe dans app/models : Category.java</p>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package models;</span>

    <span class="kw">import play.db.ebean.Model;</span>
    <span class="kw">import javax.persistence.*;</span>

    @Entity
    <span class="kw">public</span> <span class="kw">class</span> Category <span class="kw">extends</span> Model {

        @Id
        <span class="kw">public</span> Long id;
        <span class="kw">public</span> String label;

        <span class="kw">public</span> <span class="dt">static</span> Finder&lt;Long, Category&gt; find = <span class="kw">new</span> Finder&lt;Long, Category&gt;(Long.<span class="fu">class</span>, Category.<span class="fu">class</span>);

    }

    <span class="co">//TODO : parler des différence avec play1, hibernate versus ebean etc ...</span></code></pre>
<ul>
<li>Redémarrez l'application</li>
<li>connectez vous à <a href="http://localhost:9000/">http://localhost:9000/</a> dans votre navigateur</li>
<li>Play!► va vous proposer de créer le modèle de données :</li>
<li>Clickez sur <code>apply this script now</code></li>
</ul>
<div class="figure">
<img src="rsrc/part00-ch00.013.png" /><p class="caption"></p>
</div>
<p>... votre base de données est créée.</p>
<h3 id="création-dun-2ème-modèle-bookmark"><a href="#TOC">Création d'un 2ème modèle : Bookmark</a></h3>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package models;</span>

    <span class="kw">import play.db.ebean.Model;</span>
    <span class="kw">import javax.persistence.*;</span>

    @Entity
    <span class="kw">public</span> <span class="kw">class</span> Bookmark <span class="kw">extends</span> Model {

        @Id
        <span class="kw">public</span> Long id;
        <span class="kw">public</span> String title;
        <span class="kw">public</span> String url;
        <span class="kw">public</span> String details;

        @ManyToOne
        <span class="kw">public</span> Category category;

        <span class="kw">public</span> <span class="dt">static</span> Finder&lt;Long, Bookmark&gt; find = <span class="kw">new</span> Finder&lt;Long, Bookmark&gt;(Long.<span class="fu">class</span>, Bookmark.<span class="fu">class</span>);

    }</code></pre>
<h3 id="mettez-à-jour-category.java"><a href="#TOC">Mettez à jour Category.java :</a></h3>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package models;</span>

    <span class="co">//ajout</span>
    <span class="kw">import java.util.ArrayList;</span>
    <span class="kw">import java.util.List;</span>

    <span class="kw">import play.db.ebean.Model;</span>
    <span class="kw">import javax.persistence.*;</span>

    @Entity
    <span class="kw">public</span> <span class="kw">class</span> Category <span class="kw">extends</span> Model {

        @Id
        <span class="kw">public</span> Long id;
        <span class="kw">public</span> String label;

        <span class="co">//ajout</span>
        <span class="co">//@OneToMany(mappedBy=&quot;category&quot;,cascade=CascadeType.ALL)</span>
        <span class="co">//public List&lt;Bookmark&gt; bookmarks = new ArrayList();</span>

        <span class="kw">public</span> <span class="dt">static</span> Finder&lt;Long, Category&gt; find = <span class="kw">new</span> Finder&lt;Long, Category&gt;(Long.<span class="fu">class</span>, Category.<span class="fu">class</span>);

    }</code></pre>
<p>Si vous créez un nouveau modèle et que vous raffraîchissez votre page, Play!► vous proposera à nouveau de mettre à jour votre modèle de données. ... Donc faites le.</p>
<h2 id="contrôleurs"><a href="#TOC">Contrôleurs</a></h2>
<h3 id="création-dun-contrôleur-bookmarks"><a href="#TOC">Création d'un Contrôleur : Bookmarks</a></h3>
<p>Dans <code>/app/controllers/</code> créez la classe <code>Bookmarks.java</code> :</p>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package controllers;</span>

    <span class="kw">import play.*;</span>
    <span class="kw">import play.mvc.*;</span>
    <span class="kw">import play.data.*;</span>

    <span class="kw">import views.html.*;</span>

    <span class="kw">import models.*;</span>

    <span class="kw">public</span> <span class="kw">class</span> Bookmarks <span class="kw">extends</span> Controller {

      <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">add</span>() {

        <span class="dt">final</span> Form&lt;Bookmark&gt; bookmarkForm = <span class="fu">form</span>(Bookmark.<span class="fu">class</span>).<span class="fu">bindFromRequest</span>();
        <span class="dt">final</span> Bookmark bookmark = bookmarkForm.<span class="fu">get</span>();

        bookmark.<span class="fu">save</span>();
        <span class="kw">return</span> <span class="fu">redirect</span>(routes.<span class="fu">Application</span>.<span class="fu">index</span>());

      }

    }</code></pre>
<h4 id="explications"><a href="#TOC">Explications :</a></h4>
<pre><code>//TODO</code></pre>
<h4 id="modification-du-fichier-routes"><a href="#TOC">Modification du fichier routes</a></h4>
<p>Dans le fichier route, ajoutez :</p>
<pre><code>POST /bookmark/add  controllers.Bookmarks.add()</code></pre>
<h3 id="contrôleur-categories"><a href="#TOC">Contrôleur Categories :</a></h3>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package controllers;</span>

    <span class="kw">import play.*;</span>
    <span class="kw">import play.mvc.*;</span>
    <span class="kw">import play.data.*;</span>

    <span class="kw">import views.html.*;</span>

    <span class="kw">import models.*;</span>

    <span class="kw">public</span> <span class="kw">class</span> Categories <span class="kw">extends</span> Controller {

      <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">add</span>() {

        <span class="dt">final</span> Form&lt;Category&gt; categoryForm = <span class="fu">form</span>(Category.<span class="fu">class</span>).<span class="fu">bindFromRequest</span>();
        <span class="dt">final</span> Category category = categoryForm.<span class="fu">get</span>();

        category.<span class="fu">save</span>();
        <span class="kw">return</span> <span class="fu">redirect</span>(routes.<span class="fu">Application</span>.<span class="fu">index</span>());

      }

    }</code></pre>
<h4 id="fichier-routes"><a href="#TOC">Fichier &quot;routes&quot;</a></h4>
<pre><code># Routes
# This file defines all application routes (Higher priority routes first)
# ~~~~

# Home page
GET     /                           controllers.Application.index()

POST /bookmark/add  controllers.Bookmarks.add()
POST /category/add  controllers.Categories.add()


# Map static resources from the /public folder to the /assets URL path
GET     /assets/*file               controllers.Assets.at(path=&quot;/public&quot;, file)</code></pre>
<h3 id="modification-du-contrôleur-application"><a href="#TOC">Modification du Contrôleur Application :</a></h3>
<p>La modification consiste juste à rajouter les listes des bookmarks et des catégories en paramètre de la méthode render.</p>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package controllers;</span>

    <span class="kw">import play.*;</span>
    <span class="kw">import play.mvc.*;</span>

    <span class="kw">import views.html.*;</span>

    <span class="kw">import models.*;</span>

    <span class="kw">public</span> <span class="kw">class</span> Application <span class="kw">extends</span> Controller {

      <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">index</span>() {

        <span class="kw">return</span> <span class="fu">ok</span>(index.<span class="fu">render</span>(
            <span class="st">&quot;Vous pouvez commencer à saisir ...&quot;</span>, 
            Bookmark.<span class="fu">find</span>.<span class="fu">fetch</span>(<span class="st">&quot;category&quot;</span>).<span class="fu">orderBy</span>(<span class="st">&quot;title&quot;</span>).<span class="fu">findList</span>(),
            Category.<span class="fu">find</span>.<span class="fu">orderBy</span>(<span class="st">&quot;label&quot;</span>).<span class="fu">findList</span>()
        ));
      }

    }</code></pre>
<h2 id="vues"><a href="#TOC">Vues</a></h2>
<pre><code>//TODO : blabla</code></pre>
<h3 id="modification-de-la-vue-principale-index.scala.html"><a href="#TOC">Modification de la vue principale : index.scala.html</a></h3>
<pre class="sourceCode html"><code class="sourceCode html">    @(
        message: String,
        bookmarks: List[models.Bookmark],
        categories: List[models.Category]
    )

    @main(&quot;Gestion des bookmarks&quot;) {

        <span class="kw">&lt;h1&gt;</span>BookMarks<span class="kw">&lt;/h1&gt;</span>
        <span class="kw">&lt;p&gt;</span>@message<span class="kw">&lt;/p&gt;</span>
        <span class="co">&lt;!-- Formulaire de saisie : Catégories --&gt;</span>
        <span class="kw">&lt;fieldset&gt;</span>
            <span class="kw">&lt;legend&gt;</span>Nouvelle Cat<span class="dv">&amp;eacute;</span>gorie<span class="kw">&lt;/legend&gt;</span>
            <span class="kw">&lt;form</span><span class="ot"> method=</span><span class="st">&quot;post&quot;</span><span class="ot"> action=</span><span class="st">&quot;@routes.Categories.add()&quot;</span><span class="kw">&gt;</span>
                <span class="kw">&lt;input</span><span class="ot"> name=</span><span class="st">&quot;label&quot;</span><span class="ot"> placeholder=</span><span class="st">&quot;label&quot;</span><span class="kw">&gt;</span>
                <span class="kw">&lt;button</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="kw">&gt;</span>Ajouter la Cat<span class="dv">&amp;eacute;</span>gorie<span class="kw">&lt;/button&gt;</span>
            <span class="kw">&lt;/form&gt;</span>
        <span class="kw">&lt;/fieldset&gt;</span>
        <span class="co">&lt;!-- Liste des Catégories --&gt;</span>
        <span class="kw">&lt;ul&gt;</span>
            @for(category <span class="er">&lt;</span>- categories) {
                <span class="kw">&lt;li&gt;</span>@category.id @category.label<span class="kw">&lt;/li&gt;</span>
            }
        <span class="kw">&lt;/ul&gt;</span>   

        <span class="co">&lt;!-- Formulaire de saisie : Bookmarks --&gt;</span>

        <span class="kw">&lt;fieldset&gt;</span>
            <span class="kw">&lt;legend&gt;</span>Nouveau Bookmark<span class="kw">&lt;/legend&gt;</span>
            <span class="kw">&lt;form</span><span class="ot"> method=</span><span class="st">&quot;post&quot;</span><span class="ot"> action=</span><span class="st">&quot;@routes.Bookmarks.add()&quot;</span><span class="kw">&gt;</span>
                <span class="kw">&lt;input</span><span class="ot"> name=</span><span class="st">&quot;title&quot;</span><span class="ot"> placeholder=</span><span class="st">&quot;title&quot;</span><span class="kw">&gt;</span>
                <span class="kw">&lt;input</span><span class="ot"> name=</span><span class="st">&quot;url&quot;</span><span class="ot"> placeholder=</span><span class="st">&quot;url&quot;</span><span class="kw">&gt;</span>
                <span class="kw">&lt;input</span><span class="ot"> name=</span><span class="st">&quot;details&quot;</span><span class="ot"> placeholder=</span><span class="st">&quot;details&quot;</span><span class="kw">&gt;</span>

                <span class="kw">&lt;select</span><span class="ot"> size=</span><span class="st">&quot;1&quot;</span><span class="ot"> name=</span><span class="st">&quot;category.id&quot;</span><span class="kw">&gt;</span>
                    @for(category <span class="er">&lt;</span>- categories) {
                        <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">&quot;@category.id&quot;</span><span class="kw">&gt;</span>@category.label<span class="kw">&lt;/option&gt;</span>
                    }
                <span class="kw">&lt;/select&gt;</span>

                <span class="kw">&lt;button</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="kw">&gt;</span>Ajouter le Bookmark<span class="kw">&lt;/button&gt;</span>
            <span class="kw">&lt;/form&gt;</span>
        <span class="kw">&lt;/fieldset&gt;</span>
        <span class="co">&lt;!-- Liste des Bookmarks --&gt;</span>
        <span class="kw">&lt;ul&gt;</span>
            @for(bookmark <span class="er">&lt;</span>- bookmarks) {
                <span class="kw">&lt;li&gt;</span>@bookmark.title : <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;@bookmark.url&quot;</span><span class="kw">&gt;</span>@bookmark.url<span class="kw">&lt;/a&gt;</span> : 
                     @if(bookmark.category != null) { 
                        @bookmark.category.label
                    }
                <span class="kw">&lt;/li&gt;</span>
            }
        <span class="kw">&lt;/ul&gt;</span>
    }</code></pre>
<p>Lancez :</p>
<div class="figure">
<img src="rsrc/part00-ch00.014.png" /><p class="caption"></p>
</div>
<p>Jouez :</p>
<div class="figure">
<img src="rsrc/part00-ch00.015.png" /><p class="caption"></p>
</div>
<h2 id="allez-un-peu-de-js-des-services-maintenant"><a href="#TOC">Allez un peu de JS &amp; des services maintenant !</a></h2>
<p>Personnellement, je ne suis pas fan du templating scala, donc je vais régler ça en javascript, html &amp; css ;)</p>
<h3 id="obtenir-la-liste-des-catégories"><a href="#TOC">Obtenir la liste des catégories</a></h3>
<p>Allons modifier le code du contrôleur <code>Categories.java</code> :</p>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package controllers;</span>

    <span class="kw">import models.Category;</span>
    <span class="kw">import play.data.Form;</span>
    <span class="kw">import play.mvc.Controller;</span>
    <span class="kw">import play.mvc.Result;</span>

    <span class="kw">import java.util.HashMap;</span>
    <span class="kw">import java.util.List;</span>
    <span class="kw">import java.util.Map;</span>

    <span class="kw">import static play.libs.Json.toJson;</span>


    <span class="kw">public</span> <span class="kw">class</span> Categories <span class="kw">extends</span> Controller {

        <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">add</span>() {

            <span class="dt">final</span> Form&lt;Category&gt; categoryForm = <span class="fu">form</span>(Category.<span class="fu">class</span>).<span class="fu">bindFromRequest</span>();
            <span class="dt">final</span> Category category = categoryForm.<span class="fu">get</span>();

            category.<span class="fu">save</span>();
            <span class="kw">return</span> <span class="fu">redirect</span>(routes.<span class="fu">Application</span>.<span class="fu">index</span>());

        }

        <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">jsonList</span>() {

            Map&lt;String, List&lt;Category&gt;&gt; data = <span class="kw">new</span> HashMap&lt;String, List&lt;Category&gt;&gt;();
            List&lt;Category&gt; list = Category.<span class="fu">find</span>.<span class="fu">orderBy</span>(<span class="st">&quot;label&quot;</span>).<span class="fu">findList</span>();
            data.<span class="fu">put</span>(<span class="st">&quot;categories&quot;</span>, list);
            <span class="kw">return</span> <span class="fu">ok</span>(<span class="fu">toJson</span>(data));
        }

    }</code></pre>
<pre><code>TODO: expliquer</code></pre>
<p>Ensuite, dans <code>routes</code>, ajouter ceci :</p>
<pre><code>GET /categories/list controllers.Categories.jsonList()</code></pre>
<p>Et allons tester ça dans notre navigateur :</p>
<ul>
<li>connectez vous à <a href="http://localhost:9000/">http://localhost:9000/</a></li>
<li>passez en mode console</li>
</ul>
<p>... puis saisissez la requête ajax suivante (grâce à jQuery) :</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">    $.<span class="fu">ajax</span>({
        <span class="dt">type</span>:<span class="st">&quot;GET&quot;</span>,
        <span class="dt">url</span>:<span class="st">&quot;categories/list&quot;</span>,
        <span class="dt">dataType</span>:<span class="st">&quot;json&quot;</span>,
        <span class="dt">success</span>:<span class="kw">function</span>(d){ <span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;resp : &quot;</span>,d);},
        <span class="dt">error</span>:<span class="kw">function</span>(e){<span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;err : &quot;</span>,e);}
    })</code></pre>
<p>Cela peut prendre un peu de temps la 1ère fois à cause de la compilation. Mais si tout va bien vous devriez obtenir ceci :</p>
<div class="figure">
<img src="rsrc/part00-ch00.016.png" /><p class="caption"></p>
</div>
<h3 id="obtenir-la-liste-des-bookmarks"><a href="#TOC">Obtenir la liste des bookmarks</a></h3>
<p>Nous allons utiliser le même principe pour les bookmarks :</p>
<p>Modifions le contrôleur <code>Bookmarks.java</code> :</p>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package controllers;</span>

    <span class="kw">import models.Bookmark;</span>
    <span class="kw">import play.data.Form;</span>
    <span class="kw">import play.mvc.Controller;</span>
    <span class="kw">import play.mvc.Result;</span>

    <span class="kw">import java.util.HashMap;</span>
    <span class="kw">import java.util.List;</span>
    <span class="kw">import java.util.Map;</span>

    <span class="kw">import static play.libs.Json.toJson;</span>

    <span class="kw">public</span> <span class="kw">class</span> Bookmarks <span class="kw">extends</span> Controller {

        <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">add</span>() {

            <span class="dt">final</span> Form&lt;Bookmark&gt; bookmarkForm = <span class="fu">form</span>(Bookmark.<span class="fu">class</span>).<span class="fu">bindFromRequest</span>();
            <span class="dt">final</span> Bookmark bookmark = bookmarkForm.<span class="fu">get</span>();

            bookmark.<span class="fu">save</span>();
            <span class="kw">return</span> <span class="fu">redirect</span>(routes.<span class="fu">Application</span>.<span class="fu">index</span>());

        }


        <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">jsonList</span>() {

            Map&lt;String, List&lt;Bookmark&gt;&gt; data = <span class="kw">new</span> HashMap&lt;String, List&lt;Bookmark&gt;&gt;();
            List&lt;Bookmark&gt; list = Bookmark.<span class="fu">find</span>.<span class="fu">orderBy</span>(<span class="st">&quot;title&quot;</span>).<span class="fu">findList</span>();
            <span class="co">//List&lt;Bookmark&gt; list = Bookmark.find.fetch(&quot;category&quot;).orderBy(&quot;title&quot;).findList();</span>
            data.<span class="fu">put</span>(<span class="st">&quot;bookmarks&quot;</span>, list);
            <span class="kw">return</span> <span class="fu">ok</span>(<span class="fu">toJson</span>(data));
        }
    }</code></pre>
<p>Ensuite, dans <code>routes</code>, ajouter ceci :</p>
<pre><code>GET /bookmarks/list controllers.Categories.jsonList()</code></pre>
<p>... puis re-passez en mode console et saisissez la requête ajax suivante :</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">    $.<span class="fu">ajax</span>({
        <span class="dt">type</span>:<span class="st">&quot;GET&quot;</span>,
        <span class="dt">url</span>:<span class="st">&quot;bookmarks/list&quot;</span>,
        <span class="dt">dataType</span>:<span class="st">&quot;json&quot;</span>,
        <span class="dt">success</span>:<span class="kw">function</span>(d){ <span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;resp : &quot;</span>,d);},
        <span class="dt">error</span>:<span class="kw">function</span>(e){<span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;err : &quot;</span>,e);}
    })</code></pre>
<p>Et l'on obtient ceci :</p>
<div class="figure">
<img src="rsrc/part00-ch00.017.png" /><p class="caption"></p>
</div>
<p>Vous pouvez remarquer que l'on a récupéré aussi les catégories associées aux bookmarks.</p>
<p><strong>Remarque</strong> : cette fois-ci nous n'avons pas été obligé d'utiliser <code>List&lt;Bookmark&gt; list = Bookmark.find.fetch(&quot;category&quot;).orderBy(&quot;title&quot;).findList();</code>. <strong>A creuser je pense.</strong></p>
<p>Allons un peu plus loin, après les requête de type <code>GET</code>, passons aux requêtes de type <code>POST</code>.</p>
<h3 id="ajouter-une-catégorie"><a href="#TOC">Ajouter une catégorie</a></h3>
<p>Allons modifier à nouveau le code du contrôleur <code>Categories.java</code> en lui ajoutant cette méthode :</p>
<pre class="sourceCode java"><code class="sourceCode java">    @BodyParser.<span class="fu">Of</span>(BodyParser.<span class="fu">Json</span>.<span class="fu">class</span>)
    <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">jsonAdd</span>() {

        Http.<span class="fu">RequestBody</span> body = <span class="fu">request</span>().<span class="fu">body</span>();
        System.<span class="fu">out</span>.<span class="fu">println</span>(body.<span class="fu">asJson</span>());
        ObjectMapper mapper = <span class="kw">new</span> <span class="fu">ObjectMapper</span>();

        Category value = <span class="kw">null</span>;

        <span class="kw">try</span> {
            value = mapper.<span class="fu">readValue</span>(body.<span class="fu">asJson</span>().<span class="fu">toString</span>(), Category.<span class="fu">class</span>);
            Category found = Category.<span class="fu">findByLabel</span>(value.<span class="fu">label</span>);
            <span class="kw">if</span>(found!=<span class="kw">null</span>){
                System.<span class="fu">out</span>.<span class="fu">println</span>(value.<span class="fu">label</span> + <span class="st">&quot; already exists&quot;</span>);
                value.<span class="fu">id</span> = found.<span class="fu">id</span>;

            } <span class="kw">else</span> {
                value.<span class="fu">save</span>();
                System.<span class="fu">out</span>.<span class="fu">println</span>(value.<span class="fu">id</span>.<span class="fu">toString</span>()+<span class="st">&quot; &quot;</span>+value.<span class="fu">label</span> + <span class="st">&quot; has been saved&quot;</span>);
            }

        } <span class="kw">catch</span> (IOException e) {
            e.<span class="fu">printStackTrace</span>();
        }

        <span class="kw">return</span> <span class="fu">ok</span>(<span class="fu">toJson</span>(value));
    }</code></pre>
<pre><code>//TODO : expliquer</code></pre>
<p>Au final le code avec les bons <code>imports</code> sera le suivant :</p>
<pre class="sourceCode java"><code class="sourceCode java">    <span class="kw">package controllers;</span>

    <span class="kw">import models.Category;</span>
    <span class="kw">import org.codehaus.jackson.map.ObjectMapper;</span>
    <span class="kw">import play.data.Form;</span>
    <span class="kw">import play.mvc.BodyParser;</span>
    <span class="kw">import play.mvc.Controller;</span>
    <span class="kw">import play.mvc.Http;</span>
    <span class="kw">import play.mvc.Result;</span>

    <span class="kw">import java.io.IOException;</span>
    <span class="kw">import java.util.HashMap;</span>
    <span class="kw">import java.util.List;</span>
    <span class="kw">import java.util.Map;</span>

    <span class="kw">import static play.libs.Json.toJson;</span>


    <span class="kw">public</span> <span class="kw">class</span> Categories <span class="kw">extends</span> Controller {

        <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">add</span>() {
            <span class="dt">final</span> Form&lt;Category&gt; categoryForm = <span class="fu">form</span>(Category.<span class="fu">class</span>).<span class="fu">bindFromRequest</span>();
            <span class="dt">final</span> Category category = categoryForm.<span class="fu">get</span>();

            category.<span class="fu">save</span>();
            <span class="kw">return</span> <span class="fu">redirect</span>(routes.<span class="fu">Application</span>.<span class="fu">index</span>());
        }

        <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">jsonList</span>() {

            Map&lt;String, List&lt;Category&gt;&gt; data = <span class="kw">new</span> HashMap&lt;String, List&lt;Category&gt;&gt;();
            List&lt;Category&gt; list = Category.<span class="fu">find</span>.<span class="fu">orderBy</span>(<span class="st">&quot;label&quot;</span>).<span class="fu">findList</span>();
            data.<span class="fu">put</span>(<span class="st">&quot;categories&quot;</span>, list);
            <span class="kw">return</span> <span class="fu">ok</span>(<span class="fu">toJson</span>(data));
        }

        @BodyParser.<span class="fu">Of</span>(BodyParser.<span class="fu">Json</span>.<span class="fu">class</span>)
        <span class="kw">public</span> <span class="dt">static</span> Result <span class="fu">jsonAdd</span>() {

            Http.<span class="fu">RequestBody</span> body = <span class="fu">request</span>().<span class="fu">body</span>();
            System.<span class="fu">out</span>.<span class="fu">println</span>(body.<span class="fu">asJson</span>());
            ObjectMapper mapper = <span class="kw">new</span> <span class="fu">ObjectMapper</span>();

            Category value = <span class="kw">null</span>;

            <span class="kw">try</span> {
                value = mapper.<span class="fu">readValue</span>(body.<span class="fu">asJson</span>().<span class="fu">toString</span>(), Category.<span class="fu">class</span>);
                Category found = Category.<span class="fu">findByLabel</span>(value.<span class="fu">label</span>);
                <span class="kw">if</span>(found!=<span class="kw">null</span>){
                    System.<span class="fu">out</span>.<span class="fu">println</span>(value.<span class="fu">label</span> + <span class="st">&quot; already exists&quot;</span>);
                    value.<span class="fu">id</span> = found.<span class="fu">id</span>;

                } <span class="kw">else</span> {
                    value.<span class="fu">save</span>();
                    System.<span class="fu">out</span>.<span class="fu">println</span>(value.<span class="fu">id</span>.<span class="fu">toString</span>()+<span class="st">&quot; &quot;</span>+value.<span class="fu">label</span> + <span class="st">&quot; has been saved&quot;</span>);
                }

            } <span class="kw">catch</span> (IOException e) {
                e.<span class="fu">printStackTrace</span>();
            }

            <span class="kw">return</span> <span class="fu">ok</span>(<span class="fu">toJson</span>(value));
        }

    }</code></pre>
<p>Ensuite, ajoutons dans <code>routes</code> :</p>
<pre><code>POST /jsonadd controllers.Categories.jsonAdd()</code></pre>
<p>Et retournons jouer dans la console de notre navigateur :</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">    $.<span class="fu">ajax</span>({
        <span class="dt">type</span>:<span class="st">&quot;POST&quot;</span>,
        <span class="dt">url</span>:<span class="st">&quot;jsonadd&quot;</span>,
        <span class="dt">data</span>:<span class="kw">JSON</span>.<span class="fu">stringify</span>({ <span class="dt">label</span>:<span class="st">&quot;dart&quot;</span>}),
        <span class="dt">dataType</span>:<span class="st">&quot;json&quot;</span>,
        <span class="dt">contentType</span>:<span class="st">&quot;application/json&quot;</span>,
        <span class="dt">success</span>:<span class="kw">function</span>(d){ <span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;resp : &quot;</span>,d);},
        <span class="dt">error</span>:<span class="kw">function</span>(e){<span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;err : &quot;</span>,e);}
    })</code></pre>
<p>Côté Terminal, vous devriez voir s'afficher un message de ce type :</p>
<pre><code>{&quot;label&quot;:&quot;dart&quot;}
41 dart has been saved</code></pre>
<p>Côté console du navigateur, vous aurez ceci :</p>
<div class="figure">
<img src="rsrc/part00-ch00.018.png" /><p class="caption"></p>
</div>
<p>On peut donc voir que Play!&gt; a bien affecté un id à la nouvelle catégorie.</p>
<p>puis relancez la requête ajax une deuxième fois :</p>
<p>Côté Terminal, vous aurez le message suivant :</p>
<pre><code>{&quot;label&quot;:&quot;dart&quot;}
dart already exists</code></pre>
<p>Et côté console du navigateur, vous obtiendrez la même chose que lors de l'ajout.</p>
<h2 id="cest-tout-pour-cette-partie"><a href="#TOC">C'est tout pour cette partie</a></h2>
<p>Vous avez maintenant de quoi commencer à jouer avec Play!&gt; 2. Nous avons aujourd'hui tous les éléments nécessaires pour faire évoluer notre application. La prochaine partie utilisera ce que nous avons fait pour transformer notre application en &quot;webapp&quot; (une seule page côté client) avec le framework Backbone.js.</p>
<p>à bientôt pour la suite.</p>
</body>
</html>
