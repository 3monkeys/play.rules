/*!
 * Amplify 1.0a1
 * 
 * Copyright 2011 appendTo LLC. (http://appendto.com/team)
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 * 
 * http://amplifyjs.com
 */
(function(f){var j=[].slice,l={};this.amplify={publish:function(i){var b=j.call(arguments,1),c;if(!l[i])return true;f.each(l[i],function(d,a){return c=a.callback.apply(a.context,b)});return c!==false},subscribe:function(i,b,c,d){if(arguments.length===3&&typeof c==="number"){d=c;c=b;b=null}if(arguments.length===2){c=b;b=null}d=d||10;l[i]||(l[i]=[]);for(var a=l[i].length-1,e={callback:c,context:b,priority:d};a>=0;a--)if(l[i][a].priority<=d){l[i].splice(a+1,0,e);return c}l[i].unshift(e);return c},unsubscribe:function(i,
b){l[i]&&f.each(l[i],function(c,d){if(d.callback===b){l[i].splice(c,1);return false}})}}})(jQuery);
(function(f,j,l){function i(b,c){var d=c.__amplify__?JSON.parse(c.__amplify__):{};f.store.addType(b,function(a,e,g){var h=e,k=(new Date).getTime();if(!a){h={};for(a in d){e=(e=c[a])?JSON.parse(e):{expires:-1};if(e.expires&&e.expires<=k){delete c[a];delete d[a]}else h[a.replace(/^__amplify__/,"")]=e.data}c.__amplify__=JSON.stringify(d);return h}a="__amplify__"+a;if(e===l){if(d[a]){e=(e=c[a])?JSON.parse(e):{expires:-1};if(e.expires&&e.expires<=k){delete c[a];delete d[a]}else return e.data}}else if(e===
null){delete c[a];delete d[a]}else{c[a]=JSON.stringify({data:e,expires:g.expires?k+g.expires:null});d[a]=true}c.__amplify__=JSON.stringify(d);return h})}f.store=function(b,c,d){var a=f.store.type;if(d&&d.type&&d.type in f.store.types)a=d.type;return f.store.types[a](b,c,d||{})};j.extend(f.store,{types:{},type:null,addType:function(b,c){if(!this.type)this.type=b;this.types[b]=c;f.store[b]=function(d,a,e){return f.store(d,a,j.extend({type:b},e))}}});j.each(["localStorage","sessionStorage"],function(b,
c){try{window[c].getItem&&i(c,window[c])}catch(d){}});window.globalStorage&&i("globalStorage",window.globalStorage[window.location.hostname]);(function(){var b=j("<div>").hide().appendTo("html")[0],c;if(b.addBehavior){b.addBehavior("#default#userdata");b.load("amplify");c=b.getAttribute("amplify")?JSON.parse(b.getAttribute("amplify")):{};f.store.addType("userData",function(d,a,e){var g=a,h=(new Date).getTime();if(!d){g={};for(d in c){a=(a=b.getAttribute(d))?JSON.parse(a):{expires:-1};if(a.expires&&
a.expires<=h){b.removeAttribute(d);delete c[d]}else g[d]=a.data}b.setAttribute("amplify",JSON.stringify(c));b.save("amplify");return g}d=d.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");if(a===l){if(d in c){a=(a=b.getAttribute(d))?JSON.parse(a):{expires:-1};if(a.expires&&a.expires<=h){b.removeAttribute(d);delete c[d]}else return a.data}}else if(a===null){b.removeAttribute(d);delete c[d]}else{b.setAttribute(d,JSON.stringify({data:a,
expires:e.expires?h+e.expires:null}));c[d]=true}b.setAttribute("amplify",JSON.stringify(c));b.save("amplify");return g})}})();i("memory",{});j.cookie&&j.support.cookie&&f.store.addType("cookie",function(b,c,d){return j.cookie(b,c,{expires:d.expires||99E9,path:"/"})})})(amplify,jQuery);
(function(f,j,l){f.request=function(b,c,d){var a=b||{};if(typeof a==="string"){if(j.isFunction(c)){d=c;c={}}a={resourceId:b,data:c||{},success:d}}b=f.request.resources[a.resourceId];var e=a.success||j.noop,g=a.error||j.noop;a.success=function(h,k){f.publish("request.success",a,h,k);f.publish("request.complete",a,h,k);e.apply(this,arguments)};a.error=function(h,k){f.publish("request.error",a,h,k);f.publish("request.complete",a,h,k);g.apply(this,arguments)};if(!b){if(!a.resourceId)throw"amplify.request: no resourceId provided";
throw"amplify.request: unknown resourceId: "+a.resourceId;}f.publish("request.before",a)&&f.request.resources[a.resourceId](a)};j.extend(f.request,{types:{},resources:{},define:function(b,c,d){if(typeof c==="string"){if(!(c in f.request.types))throw"amplify.request.define: unknown type: "+c;d.resourceId=b;f.request.resources[b]=f.request.types[c](d)}else f.request.resources[b]=c}});f.request.types.ajax=function(b){b=j.extend({type:"GET"},b);return function(c){var d=b.url,a=c.data,e;if(typeof a!==
"string"){a=j.extend(true,{},b.data,a);j.each(a,function(g,h){e=RegExp("{"+g+"}","g");if(e.test(d)){d=d.replace(e,h);delete a[g]}})}j.ajax(j.extend({},b,{url:d,type:b.type,data:a,dataType:b.dataType,success:function(g,h,k){c.success(g,k)},error:function(g,h,k,m){if(m===l)m=null;c.error(m,g)},beforeSend:function(g,h){return(b.beforeSend?b.beforeSend.apply(this,arguments):true)&&f.publish("request.before.ajax",b,c,h,g)}}))}};var i=f.request.cache={_key:function(b,c){function d(){return c.charCodeAt(e++)<<
24|c.charCodeAt(e++)<<16|c.charCodeAt(e++)<<8|c.charCodeAt(e++)<<0}for(var a=c.length,e=0,g=d();e<a;)g^=d();return"request-"+b+"-"+g},_default:function(){var b={};return function(c,d,a){var e=i._key(c.resourceId,a.data),g=c.cache;if(e in b){a.success(b[e]);return false}var h=a.success;a.success=function(k){b[e]=k;typeof g==="number"&&setTimeout(function(){delete b[e]},g);h.apply(this,arguments)}}}()};if(f.store){j.each(f.store.types,function(b){i[b]=function(c,d,a){var e=i._key(c.resourceId,a.data);
if(c=f.store[b](e)){a.success(c);return false}var g=a.success;a.success=function(h){f.store[b](e,h);g.apply(this,arguments)}}});i.persist=i[f.store.type]}f.subscribe("request.before.ajax",function(b){var c=b.cache;if(c)return i[c in i?c:"_default"].apply(this,arguments)});f.request.decoders={jsend:function(b,c,d,a,e){if(b.status==="success")a(b.data);else if(b.status==="fail")e(b.data,"fail");else if(b.status==="error"){delete b.status;e(b)}}};f.subscribe("request.before.ajax",function(b,c,d){function a(m){return function(n){g(n,
"success",m)}}function e(m){return function(n){h(m,"error",null,n)}}var g=d.success,h=d.error,k=j.isFunction(b.decoder)?b.decoder:b.decoder in f.request.decoders?f.request.decoders[b.decoder]:f.request.decoders._default;if(k){d.success=function(m,n,o){k(m,n,o,a(o),e(o))};d.error=function(m,n){k(null,n,m,a(m),e(m))}}})})(amplify,jQuery);
